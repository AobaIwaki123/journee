# Journee ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

## ğŸ“‹ ç›®çš„

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Journeeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ¼ãƒ‰å“è³ªå‘ä¸Šã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§æ”¹å–„ã®ãŸã‚ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ–¹é‡ã‚’å®šç¾©ã—ã¾ã™ã€‚

## ğŸ” ç¾çŠ¶åˆ†æ

### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œç‚¹

#### 1. ãƒ†ã‚¹ãƒˆã®æ¬ å¦‚
- **å•é¡Œ**: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒå…¨ãå­˜åœ¨ã—ãªã„
- **å½±éŸ¿**: ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒªã‚¹ã‚¯ãŒé«˜ã„ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãŒå›°é›£
- **å„ªå…ˆåº¦**: ğŸ”´ é«˜

#### 2. å¤§ãã™ãã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
- **å•é¡Œ**: `lib/store/useStore.ts` ãŒ537è¡Œã¨è‚¥å¤§åŒ–
- **å½±éŸ¿**: å¯èª­æ€§ä½ä¸‹ã€è²¬å‹™ã®åˆ†æ•£ãŒä¸æ˜ç¢º
- **å„ªå…ˆåº¦**: ğŸŸ¡ ä¸­

#### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¸€è²«æ€§
- **å•é¡Œ**: ã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒå„æ‰€ã§ç•°ãªã‚‹å®Ÿè£…
- **å½±éŸ¿**: ãƒ‡ãƒãƒƒã‚°ãŒå›°é›£ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®ä¸çµ±ä¸€
- **å„ªå…ˆåº¦**: ğŸŸ¡ ä¸­

#### 4. å‹å®‰å…¨æ€§ã®èª²é¡Œ
- **å•é¡Œ**: ä¸€éƒ¨ã§`any`å‹ã®ä½¿ç”¨ã€å‹å®šç¾©ã®é‡è¤‡
- **å½±éŸ¿**: å‹å®‰å…¨æ€§ã®ä½ä¸‹ã€è£œå®Œã®åŠ¹ãã«ãã•
- **å„ªå…ˆåº¦**: ğŸŸ¢ ä½

## ğŸ¯ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ–¹é‡

### ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ†ã‚¹ãƒˆã‚¤ãƒ³ãƒ•ãƒ©ã®æ§‹ç¯‰

#### 1.1 ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å°å…¥
- **æ¡ç”¨æŠ€è¡“**: Vitestï¼ˆNext.js 14+ã¨ã®ç›¸æ€§ãŒè‰¯ã„ï¼‰
- **ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: @testing-library/react
- **ãƒ¢ãƒƒã‚¯**: mswï¼ˆAPI mockingï¼‰

**ç†ç”±**:
- Vitestã¯é«˜é€Ÿã§TypeScriptãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆ
- Next.jsã¨ã®çµ±åˆãŒå®¹æ˜“
- Jestã‹ã‚‰ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ãŒã‚·ãƒ³ãƒ—ãƒ«

#### 1.2 ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
/__tests__/
  /unit/              # å˜ä½“ãƒ†ã‚¹ãƒˆ
    /lib/
      /ai/
      /store/
      /utils/
    /components/
  /integration/       # çµ±åˆãƒ†ã‚¹ãƒˆ
    /api/
  /e2e/              # E2Eãƒ†ã‚¹ãƒˆï¼ˆå°†æ¥çš„ã«ï¼‰
/vitest.config.ts    # Vitestè¨­å®š
```

### ãƒ•ã‚§ãƒ¼ã‚º2: ã‚³ãƒ¼ãƒ‰ã®åˆ†å‰²ã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–

#### 2.1 Zustandã‚¹ãƒˆã‚¢ã®åˆ†å‰²

**ç¾çŠ¶**: `useStore.ts`ã«å…¨ã¦ã®ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ãŒé›†ç´„ï¼ˆ537è¡Œï¼‰

**æ”¹å–„æ¡ˆ**: è²¬å‹™ã”ã¨ã«ã‚¹ãƒˆã‚¢ã‚’åˆ†å‰²

```typescript
lib/store/
  â”œâ”€â”€ useChatStore.ts        # ãƒãƒ£ãƒƒãƒˆé–¢é€£ã®ã‚¹ãƒ†ãƒ¼ãƒˆ
  â”œâ”€â”€ useItineraryStore.ts   # ã—ãŠã‚Šé–¢é€£ã®ã‚¹ãƒ†ãƒ¼ãƒˆ
  â”œâ”€â”€ useUIStore.ts          # UIçŠ¶æ…‹ï¼ˆãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€ã‚¨ãƒ©ãƒ¼ãªã©ï¼‰
  â”œâ”€â”€ useSettingsStore.ts    # è¨­å®šé–¢é€£ã®ã‚¹ãƒ†ãƒ¼ãƒˆ
  â”œâ”€â”€ useHistoryStore.ts     # Undo/Redoå±¥æ­´ç®¡ç†
  â”œâ”€â”€ useToastStore.ts       # ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥
  â””â”€â”€ index.ts               # çµ±åˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
```

**åˆ©ç‚¹**:
- è²¬å‹™ãŒæ˜ç¢ºåŒ–
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®å‰Šæ¸›
- ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“
- ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®æœ€é©åŒ–

#### 2.2 ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®æŠ½å‡º

**ç¾çŠ¶**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒæ··åœ¨

**æ”¹å–„æ¡ˆ**: ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã«åˆ†é›¢

```typescript
lib/hooks/
  â”œâ”€â”€ useChat.ts              # ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®ãƒ­ã‚¸ãƒƒã‚¯
  â”œâ”€â”€ useItineraryEditor.ts   # ã—ãŠã‚Šç·¨é›†ã®ãƒ­ã‚¸ãƒƒã‚¯
  â””â”€â”€ useStreamingResponse.ts # ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†

lib/utils/
  â”œâ”€â”€ itinerary-helpers.ts    # ã—ãŠã‚Šæ“ä½œã®ãƒ˜ãƒ«ãƒ‘ãƒ¼
  â”œâ”€â”€ validation.ts           # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
  â””â”€â”€ formatting.ts           # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
```

### ãƒ•ã‚§ãƒ¼ã‚º3: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€

#### 3.1 ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹ã®å®šç¾©
```typescript
lib/errors/
  â”œâ”€â”€ AppError.ts           # åŸºåº•ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹
  â”œâ”€â”€ APIError.ts           # APIé–¢é€£ã‚¨ãƒ©ãƒ¼
  â”œâ”€â”€ ValidationError.ts    # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
  â””â”€â”€ index.ts
```

#### 3.2 ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒªã®å®Ÿè£…
```typescript
components/errors/
  â”œâ”€â”€ ErrorBoundary.tsx     # React Error Boundary
  â””â”€â”€ APIErrorHandler.tsx   # API ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
```

### ãƒ•ã‚§ãƒ¼ã‚º4: å‹å®‰å…¨æ€§ã®å‘ä¸Š

#### 4.1 `any`å‹ã®å‰Šæ¸›
- æ˜ç¤ºçš„ãªå‹å®šç¾©ã¸ã®ç½®ãæ›ãˆ
- å‹ã‚¬ãƒ¼ãƒ‰é–¢æ•°ã®è¿½åŠ 
- ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã®æ´»ç”¨

#### 4.2 å‹å®šç¾©ã®æ•´ç†
```typescript
types/
  â”œâ”€â”€ common.ts            # å…±é€šå‹
  â”œâ”€â”€ domain/              # ãƒ‰ãƒ¡ã‚¤ãƒ³å‹
  â”‚   â”œâ”€â”€ chat.ts
  â”‚   â”œâ”€â”€ itinerary.ts
  â”‚   â””â”€â”€ user.ts
  â””â”€â”€ api/                 # APIå‹
      â”œâ”€â”€ requests.ts
      â””â”€â”€ responses.ts
```

## ğŸ“ ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™
- **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°**: 90%ä»¥ä¸Š
- **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯**: 80%ä»¥ä¸Š
- **API Route**: 80%ä»¥ä¸Š
- **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: 60%ä»¥ä¸Šï¼ˆé‡è¦ãªã‚‚ã®å„ªå…ˆï¼‰

### å„ªå…ˆåº¦ä»˜ã‘ãƒ†ã‚¹ãƒˆå¯¾è±¡

#### ğŸ”´ é«˜å„ªå…ˆåº¦
1. **AIçµ±åˆãƒ­ã‚¸ãƒƒã‚¯** (`lib/ai/prompts.ts`)
   - `parseAIResponse`: JSONæŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯
   - `mergeItineraryData`: ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯
   - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹: æ­£å¸¸ç³»ã€ç•°å¸¸ç³»ã€å¢ƒç•Œå€¤

2. **ãƒãƒ£ãƒƒãƒˆAPI** (`app/api/chat/route.ts`)
   - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°/éã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°
   - ãƒ¢ãƒ‡ãƒ«åˆ‡ã‚Šæ›¿ãˆï¼ˆGemini/Claudeï¼‰
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

3. **ã‚¹ãƒˆã‚¢æ“ä½œ** (`lib/store/useStore.ts`)
   - ã—ãŠã‚Šç·¨é›†ï¼ˆè¿½åŠ ã€æ›´æ–°ã€å‰Šé™¤ï¼‰
   - Undo/Redoæ©Ÿèƒ½
   - çŠ¶æ…‹æ•´åˆæ€§

#### ğŸŸ¡ ä¸­å„ªå…ˆåº¦
4. **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°**
   - `storage.ts`: LocalStorageæ“ä½œ
   - `time-utils.ts`: æ™‚é–“è¨ˆç®—
   - `encryption.ts`: æš—å·åŒ–

5. **ãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†**
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
   - ãƒ‡ãƒ¼ã‚¿å¤‰æ›

#### ğŸŸ¢ ä½å„ªå…ˆåº¦
6. **UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**
   - é™çš„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
   - ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤

### ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³

#### å˜ä½“ãƒ†ã‚¹ãƒˆä¾‹
```typescript
// __tests__/unit/lib/ai/prompts.test.ts
import { describe, it, expect } from 'vitest';
import { parseAIResponse, mergeItineraryData } from '@/lib/ai/prompts';

describe('parseAIResponse', () => {
  it('should extract JSON from response', () => {
    const response = 'ãƒ†ã‚­ã‚¹ãƒˆ\n```json\n{"title":"test"}\n```';
    const result = parseAIResponse(response);
    expect(result.itineraryData).toEqual({ title: 'test' });
    expect(result.message).toBe('ãƒ†ã‚­ã‚¹ãƒˆ');
  });

  it('should handle multiple JSON blocks', () => {
    // ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
  });

  it('should handle malformed JSON gracefully', () => {
    // ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹
  });
});
```

#### çµ±åˆãƒ†ã‚¹ãƒˆä¾‹
```typescript
// __tests__/integration/api/chat.test.ts
import { describe, it, expect, vi } from 'vitest';
import { POST } from '@/app/api/chat/route';

describe('POST /api/chat', () => {
  it('should return streaming response', async () => {
    // ãƒ¢ãƒƒã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    const request = new Request('http://localhost:3000/api/chat', {
      method: 'POST',
      body: JSON.stringify({
        message: 'test',
        stream: true
      })
    });

    const response = await POST(request as any);
    expect(response.headers.get('Content-Type')).toBe('text/event-stream');
  });
});
```

## ğŸš€ CI/CDçµ±åˆ

### GitHub Actionsè¨­å®š
```yaml
# .github/workflows/test.yml
name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm run test
      - run: npm run test:coverage
      - uses: codecov/codecov-action@v3
```

## ğŸ“Š å®Ÿè£…è¨ˆç”»

### ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³

#### Week 1: åŸºç¤æ§‹ç¯‰
- [ ] Vitestã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
- [ ] GitHub Actionsè¨­å®š
- [ ] ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ãƒ†ã‚¹ãƒˆï¼ˆé«˜å„ªå…ˆåº¦ï¼‰

#### Week 2: ã‚³ã‚¢æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- [ ] AIçµ±åˆãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
- [ ] ãƒãƒ£ãƒƒãƒˆAPIãƒ†ã‚¹ãƒˆ
- [ ] ã‚¹ãƒˆã‚¢åˆ†å‰²é–‹å§‹

#### Week 3: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- [ ] Zustandã‚¹ãƒˆã‚¢å®Œå…¨åˆ†å‰²
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµ±ä¸€
- [ ] å‹å®‰å…¨æ€§å‘ä¸Š

#### Week 4: ä»•ä¸Šã’
- [ ] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆï¼ˆé‡è¦ãªã‚‚ã®ï¼‰
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

## ğŸ”§ ãƒ„ãƒ¼ãƒ«ãƒ»ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### package.jsonè¿½åŠ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```json
{
  "scripts": {
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage",
    "test:watch": "vitest --watch",
    "test:ci": "vitest run --coverage"
  }
}
```

## ğŸ“š å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

- [Vitest Documentation](https://vitest.dev/)
- [Testing Library](https://testing-library.com/docs/react-testing-library/intro/)
- [Zustand Testing](https://docs.pmnd.rs/zustand/guides/testing)
- [Next.js Testing](https://nextjs.org/docs/app/building-your-application/testing)

## âœ… æˆåŠŸã®æŒ‡æ¨™

- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸70%ä»¥ä¸Š
- [ ] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå‹•ä½œ
- [ ] `useStore.ts`ã‚’5ãƒ•ã‚¡ã‚¤ãƒ«ä»¥ä¸‹ã«åˆ†å‰²
- [ ] ã™ã¹ã¦ã®`any`å‹ã‚’å‰Šæ¸›ï¼ˆå¿…è¦æœ€å°é™ï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒçµ±ä¸€ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼0ã€å‹ã‚¨ãƒ©ãƒ¼0
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã§`npm test`ãŒå®Œå…¨ã«å‹•ä½œ

---

**æœ€çµ‚æ›´æ–°**: 2025-10-07
**æ‹…å½“è€…**: Development Team
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å®Ÿè£…ä¸­