<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phase 5.5 çµ±åˆãƒ†ã‚¹ãƒˆ - å…¬é–‹URLã®å‹•ä½œç¢ºèª</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      color: #2563eb;
      border-bottom: 3px solid #2563eb;
      padding-bottom: 10px;
    }
    .step {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .step h2 {
      margin-top: 0;
      color: #1f2937;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }
    button:hover {
      background: #1d4ed8;
    }
    button.success {
      background: #10b981;
    }
    button.danger {
      background: #ef4444;
    }
    .output {
      background: #1f2937;
      color: #10b981;
      padding: 15px;
      border-radius: 6px;
      margin: 10px 0;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
    }
    .result {
      padding: 10px;
      border-radius: 6px;
      margin: 10px 0;
    }
    .result.success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #10b981;
    }
    .result.error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #ef4444;
    }
    .url-box {
      background: #f3f4f6;
      padding: 10px;
      border-radius: 6px;
      margin: 10px 0;
      word-break: break-all;
      font-family: monospace;
    }
    .instructions {
      background: #fef3c7;
      border: 1px solid #f59e0b;
      border-radius: 6px;
      padding: 15px;
      margin: 15px 0;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª Phase 5.5 çµ±åˆãƒ†ã‚¹ãƒˆ - å…¬é–‹URLå‹•ä½œç¢ºèª</h1>

  <div class="instructions">
    <h3>ğŸ“ ã“ã®ãƒ†ã‚¹ãƒˆã«ã¤ã„ã¦</h3>
    <p>ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€ã—ãŠã‚Šå…¬é–‹æ©Ÿèƒ½ã®å®Ÿéš›ã®å‹•ä½œã‚’ç¢ºèªã—ã¾ã™ã€‚LocalStorageã«ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã€å…¬é–‹URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã‹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
    <p><strong>æ³¨æ„:</strong> ã“ã®ãƒ†ã‚¹ãƒˆã¯é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ä¸Šï¼ˆhttp://localhost:3000ï¼‰ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>
  </div>

  <!-- Step 1: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ -->
  <div class="step">
    <h2>Step 1: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ</h2>
    <p>LocalStorageã«ãƒ†ã‚¹ãƒˆç”¨ã®å…¬é–‹ã—ãŠã‚Šã‚’ä¿å­˜ã—ã¾ã™ã€‚</p>
    <button onclick="step1()">ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ</button>
    <button class="danger" onclick="clearTestData()">ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢</button>
    <div id="step1-output"></div>
  </div>

  <!-- Step 2: LocalStorageã®ç¢ºèª -->
  <div class="step">
    <h2>Step 2: LocalStorageã®ç¢ºèª</h2>
    <p>ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚</p>
    <button onclick="step2()">LocalStorageã‚’ç¢ºèª</button>
    <div id="step2-output"></div>
  </div>

  <!-- Step 3: å…¬é–‹URLã®ç”Ÿæˆã¨è¡¨ç¤º -->
  <div class="step">
    <h2>Step 3: å…¬é–‹URLã®ç¢ºèª</h2>
    <p>ç”Ÿæˆã•ã‚ŒãŸå…¬é–‹URLã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
    <button onclick="step3()">å…¬é–‹URLã‚’è¡¨ç¤º</button>
    <div id="step3-output"></div>
    <div id="public-url-display"></div>
  </div>

  <!-- Step 4: å…¬é–‹ãƒšãƒ¼ã‚¸ã‚’é–‹ã -->
  <div class="step">
    <h2>Step 4: å…¬é–‹ãƒšãƒ¼ã‚¸ã‚’é–‹ã</h2>
    <p>å…¬é–‹URLã«æ–°ã—ã„ã‚¿ãƒ–ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚</p>
    <button onclick="step4()" class="success">å…¬é–‹ãƒšãƒ¼ã‚¸ã‚’é–‹ã</button>
    <div id="step4-output"></div>
  </div>

  <!-- Step 5: å®Œå…¨ãªãƒ•ãƒ­ãƒ¼ -->
  <div class="step">
    <h2>Step 5: å®Œå…¨ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ</h2>
    <p>ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è‡ªå‹•å®Ÿè¡Œã—ã¾ã™ã€‚</p>
    <button onclick="runFullTest()" class="success">å®Œå…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ</button>
    <div id="full-test-output"></div>
  </div>

  <script type="module">
    // ãƒ¢ãƒƒã‚¯ã—ãŠã‚Šãƒ‡ãƒ¼ã‚¿
    const mockItinerary = {
      id: 'integration-test-1',
      title: 'äº¬éƒ½ãƒ»å¥ˆè‰¯3æ³Š4æ—¥ã®æ—…',
      destination: 'äº¬éƒ½',
      startDate: '2024-04-01',
      endDate: '2024-04-04',
      duration: 4,
      summary: 'å¤éƒ½ã®é­…åŠ›ã‚’æº€å–«ã™ã‚‹4æ—¥é–“ã®æ—…ç¨‹',
      schedule: [
        {
          day: 1,
          date: '2024-04-01',
          title: 'äº¬éƒ½åˆ°ç€ãƒ»æ¸…æ°´å¯ºå‘¨è¾º',
          spots: [
            {
              id: 'spot-1',
              name: 'æ¸…æ°´å¯º',
              description: 'ä¸–ç•Œéºç”£ã®æœ‰åå¯ºé™¢',
              category: 'sightseeing',
              scheduledTime: '10:00',
              duration: 90,
              estimatedCost: 500,
            },
            {
              id: 'spot-2',
              name: 'äºŒå¯§å‚ãƒ»ç”£å¯§å‚',
              description: 'é¢¨æƒ…ã‚ã‚‹çŸ³ç•³ã®å‚é“',
              category: 'sightseeing',
              scheduledTime: '12:00',
              duration: 60,
              estimatedCost: 0,
            },
            {
              id: 'spot-3',
              name: 'äº¬éƒ½æ–™ç† ç“¢äº­',
              description: 'äº¬æ‡çŸ³ãƒ©ãƒ³ãƒ',
              category: 'dining',
              scheduledTime: '13:30',
              duration: 90,
              estimatedCost: 5000,
            },
          ],
          totalCost: 5500,
          totalDistance: 3.5,
          status: 'completed',
        },
        {
          day: 2,
          date: '2024-04-02',
          title: 'åµå±±ãƒ»é‡‘é–£å¯º',
          spots: [
            {
              id: 'spot-4',
              name: 'é‡‘é–£å¯º',
              description: 'é‡‘è‰²ã«è¼ãç¾ã—ã„å¯ºé™¢',
              category: 'sightseeing',
              scheduledTime: '09:00',
              duration: 60,
              estimatedCost: 500,
            },
          ],
          totalCost: 500,
          status: 'completed',
        },
      ],
      totalBudget: 6000,
      status: 'completed',
      createdAt: new Date('2024-03-01').toISOString(),
      updatedAt: new Date('2024-03-15').toISOString(),
      // Phase 5.5: å…¬é–‹è¨­å®š
      isPublic: true,
      publicSlug: 'test-kyoto-trip-2024',
      publishedAt: new Date('2024-03-15').toISOString(),
      viewCount: 0,
      allowPdfDownload: true,
      customMessage: 'ã“ã®äº¬éƒ½æ—…è¡Œè¨ˆç”»ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ï¼ç´ æ•µãªæ—…ã«ãªã‚Šã¾ã™ã‚ˆã†ã«âœ¨',
    };

    let currentSlug = 'test-kyoto-trip-2024';

    // Step 1: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
    window.step1 = function() {
      const output = document.getElementById('step1-output');
      output.innerHTML = '';
      
      try {
        // LocalStorageã«ä¿å­˜
        const publicItineraries = JSON.parse(
          localStorage.getItem('journee_public_itineraries') || '{}'
        );
        
        publicItineraries[currentSlug] = mockItinerary;
        
        localStorage.setItem(
          'journee_public_itineraries',
          JSON.stringify(publicItineraries)
        );
        
        output.innerHTML = `
          <div class="result success">
            âœ… ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ<br>
            ã‚¹ãƒ©ãƒƒã‚°: <strong>${currentSlug}</strong><br>
            ã‚¿ã‚¤ãƒˆãƒ«: <strong>${mockItinerary.title}</strong><br>
            ç›®çš„åœ°: <strong>${mockItinerary.destination}</strong><br>
            æ—¥æ•°: <strong>${mockItinerary.duration}æ—¥é–“</strong>
          </div>
        `;
      } catch (error) {
        output.innerHTML = `
          <div class="result error">
            âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}
          </div>
        `;
      }
    };

    // Step 2: LocalStorageã‚’ç¢ºèª
    window.step2 = function() {
      const output = document.getElementById('step2-output');
      output.innerHTML = '';
      
      try {
        const data = localStorage.getItem('journee_public_itineraries');
        
        if (!data) {
          output.innerHTML = `
            <div class="result error">
              âŒ LocalStorageã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“<br>
              Step 1ã§ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¦ãã ã•ã„
            </div>
          `;
          return;
        }
        
        const publicItineraries = JSON.parse(data);
        const keys = Object.keys(publicItineraries);
        
        output.innerHTML = `
          <div class="result success">
            âœ… LocalStorageãƒ‡ãƒ¼ã‚¿ç¢ºèª<br>
            ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‚¹ãƒ©ãƒƒã‚°æ•°: <strong>${keys.length}</strong><br>
            ã‚¹ãƒ©ãƒƒã‚°ä¸€è¦§: <strong>${keys.join(', ')}</strong>
          </div>
          <div class="output">${JSON.stringify(publicItineraries, null, 2)}</div>
        `;
      } catch (error) {
        output.innerHTML = `
          <div class="result error">
            âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}
          </div>
        `;
      }
    };

    // Step 3: å…¬é–‹URLã‚’è¡¨ç¤º
    window.step3 = function() {
      const output = document.getElementById('step3-output');
      const urlDisplay = document.getElementById('public-url-display');
      output.innerHTML = '';
      urlDisplay.innerHTML = '';
      
      try {
        const publicUrl = `${window.location.origin}/share/${currentSlug}`;
        
        output.innerHTML = `
          <div class="result success">
            âœ… å…¬é–‹URLç”Ÿæˆå®Œäº†
          </div>
        `;
        
        urlDisplay.innerHTML = `
          <div class="url-box">
            <strong>å…¬é–‹URL:</strong><br>
            <a href="${publicUrl}" target="_blank" style="color: #2563eb; text-decoration: underline;">
              ${publicUrl}
            </a>
          </div>
          <p style="color: #6b7280; font-size: 14px;">
            â¬†ï¸ ã“ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æ–°ã—ã„ã‚¿ãƒ–ã§å…¬é–‹ãƒšãƒ¼ã‚¸ãŒé–‹ãã¾ã™
          </p>
        `;
      } catch (error) {
        output.innerHTML = `
          <div class="result error">
            âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}
          </div>
        `;
      }
    };

    // Step 4: å…¬é–‹ãƒšãƒ¼ã‚¸ã‚’é–‹ã
    window.step4 = function() {
      const output = document.getElementById('step4-output');
      output.innerHTML = '';
      
      const publicUrl = `${window.location.origin}/share/${currentSlug}`;
      
      output.innerHTML = `
        <div class="result success">
          âœ… æ–°ã—ã„ã‚¿ãƒ–ã§å…¬é–‹ãƒšãƒ¼ã‚¸ã‚’é–‹ãã¾ã™...<br>
          <strong>ç¢ºèªé …ç›®:</strong><br>
          â–¡ ã—ãŠã‚Šã®ã‚¿ã‚¤ãƒˆãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹<br>
          â–¡ ç›®çš„åœ°ãŒè¡¨ç¤ºã•ã‚Œã‚‹<br>
          â–¡ æ—¥ç¨‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹<br>
          â–¡ ã‚¹ãƒãƒƒãƒˆæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹<br>
          â–¡ ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé’ã„ãƒœãƒƒã‚¯ã‚¹ã§è¡¨ç¤ºã•ã‚Œã‚‹<br>
          â–¡ ç·¨é›†ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„ï¼ˆRead-onlyï¼‰<br>
          â–¡ å…±æœ‰ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹<br>
          â–¡ PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹<br>
          â–¡ ãƒ•ãƒƒã‚¿ãƒ¼ã«é–²è¦§æ•°ãƒ»å…¬é–‹æ—¥ãŒè¡¨ç¤ºã•ã‚Œã‚‹
        </div>
      `;
      
      // æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
      window.open(publicUrl, '_blank');
    };

    // å®Œå…¨ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ
    window.runFullTest = async function() {
      const output = document.getElementById('full-test-output');
      output.innerHTML = '<div class="output">ãƒ†ã‚¹ãƒˆé–‹å§‹...\n</div>';
      
      const log = (message) => {
        const div = document.getElementById('full-test-output');
        div.innerHTML += message + '\n';
      };
      
      try {
        // Step 1: ãƒ‡ãƒ¼ã‚¿ä½œæˆ
        log('\nğŸ“ Step 1: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ...');
        const publicItineraries = JSON.parse(
          localStorage.getItem('journee_public_itineraries') || '{}'
        );
        publicItineraries[currentSlug] = mockItinerary;
        localStorage.setItem(
          'journee_public_itineraries',
          JSON.stringify(publicItineraries)
        );
        log('âœ… ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ');
        
        // Step 2: LocalStorageç¢ºèª
        log('\nğŸ” Step 2: LocalStorageã‚’ç¢ºèª...');
        const saved = localStorage.getItem('journee_public_itineraries');
        if (!saved) {
          throw new Error('LocalStorageã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
        }
        const parsedData = JSON.parse(saved);
        if (!parsedData[currentSlug]) {
          throw new Error('ã‚¹ãƒ©ãƒƒã‚°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        }
        log('âœ… LocalStorageã«æ­£ã—ãä¿å­˜ã•ã‚Œã¦ã„ã¾ã™');
        log(`   ã‚¹ãƒ©ãƒƒã‚°: ${currentSlug}`);
        log(`   ã‚¿ã‚¤ãƒˆãƒ«: ${parsedData[currentSlug].title}`);
        
        // Step 3: å…¬é–‹URLç”Ÿæˆ
        log('\nğŸ”— Step 3: å…¬é–‹URLã‚’ç”Ÿæˆ...');
        const publicUrl = `${window.location.origin}/share/${currentSlug}`;
        log('âœ… å…¬é–‹URL:');
        log(`   ${publicUrl}`);
        
        // Step 4: ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
        log('\nâœ… Step 4: ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼...');
        const itinerary = parsedData[currentSlug];
        log(`   å…¬é–‹ãƒ•ãƒ©ã‚°: ${itinerary.isPublic ? 'âœ… true' : 'âŒ false'}`);
        log(`   ã‚¹ãƒ©ãƒƒã‚°: ${itinerary.publicSlug}`);
        log(`   PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰: ${itinerary.allowPdfDownload ? 'âœ… è¨±å¯' : 'âŒ ä¸è¨±å¯'}`);
        log(`   ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${itinerary.customMessage || 'ãªã—'}`);
        
        // å®Œäº†
        log('\nğŸ‰ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸï¼');
        log('\næ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:');
        log('1. ä¸Šã®ã€Œå…¬é–‹ãƒšãƒ¼ã‚¸ã‚’é–‹ãã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯');
        log('2. æ–°ã—ã„ã‚¿ãƒ–ã§ã—ãŠã‚ŠãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã‹ç¢ºèª');
        log('3. ç·¨é›†ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„ã“ã¨ã‚’ç¢ºèªï¼ˆRead-onlyï¼‰');
        
      } catch (error) {
        log(`\nâŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
      }
    };

    // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
    window.clearTestData = function() {
      localStorage.removeItem('journee_public_itineraries');
      alert('âœ… ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
    };
  </script>
</body>
</html>
