# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                      ðŸŽ­ Playwright CI Benchmark Workflow                       
#                                                                                 
#   Purpose: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒžãƒãƒ¼ã‚¸ãƒ£ãƒ¼ (bun/pnpm/npm) ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã«ã‚ˆã‚‹              
#            E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã®æ¯”è¼ƒãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯                                     
#                                                                                
#   Structure:                                                                     
#     1. prepare-cache    â†’ ðŸš€ [é«˜é€ŸåŒ–ã‚³ã‚¢] ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®äº‹å‰æº–å‚™                
#     2. e2e-with-cache   â†’ â±ï¸ [ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯] ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ã‚Šè¨ˆæ¸¬                
#     3. e2e-without-cacheâ†’ â±ï¸ [ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯] ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—è¨ˆæ¸¬                
#     4. summary          â†’ ðŸ“Š [çµæžœé›†è¨ˆ] çµ±è¨ˆãƒ»æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ                
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: Playwright CI Benchmark

on:
  push:

# PRã¸ã®æ›¸ãè¾¼ã¿æ¨©é™ã‚’ä»˜ä¸Ž
permissions:
  contents: read
  pull-requests: write
  checks: write

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  NEXTAUTH_URL: http://localhost:3000
  NEXTAUTH_SECRET: ${{ secrets.NEXTAUTH_SECRET }}
  GOOGLE_CLIENT_ID: ${{ secrets.GOOGLE_CLIENT_ID }}
  GOOGLE_CLIENT_SECRET: ${{ secrets.GOOGLE_CLIENT_SECRET }}
  GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
  NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}
  NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY }}
  SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
  ENCRYPTION_KEY: ${{ secrets.ENCRYPTION_KEY }}
  NEXT_PUBLIC_ENABLE_MOCK_AUTH: true
  PLAYWRIGHT_BROWSERS: chromium

jobs:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # â–ˆâ–ˆ Step 1: prepare-cache
  # â–ˆâ–ˆ ðŸš€ é«˜é€ŸåŒ–ã‚³ã‚¢æ©Ÿèƒ½: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®äº‹å‰æº–å‚™
  # â–ˆâ–ˆ 
  # â–ˆâ–ˆ ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨Playwrightãƒ–ãƒ©ã‚¦ã‚¶ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ã—ã€
  # â–ˆâ–ˆ å¾Œç¶šã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚’é«˜é€ŸåŒ–ã™ã‚‹
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  prepare-cache:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        package-manager: [bun, pnpm, npm]
    steps:
      - uses: actions/checkout@v4
      
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  ðŸ“¦ Package Manager Setup (Composite Action)
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Setup Package Manager
        uses: ./.github/actions/setup-package-manager
        with:
          package-manager: ${{ matrix.package-manager }}

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  âš™ï¸ ç’°å¢ƒè¨­å®š (Environment Configuration)
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Configure Environment
        run: ./.github/scripts/configure-env.sh "${{ matrix.package-manager }}"

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  ðŸ”‘ ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Generate dependency cache key
        id: deps-cache-key
        run: |
          LOCKFILE_HASH=$(sha256sum ${{ env.LOCKFILE }} | cut -d' ' -f1)
          CACHE_KEY="${{ runner.os }}-${{ matrix.package-manager }}-deps-${LOCKFILE_HASH}"
          echo "dir=${{ env.CACHE_DIR }}" >> $GITHUB_OUTPUT
          echo "key=${CACHE_KEY}" >> $GITHUB_OUTPUT
          echo "ðŸ“¦ Dependency Cache Key: ${CACHE_KEY}"

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  ðŸš€ é«˜é€ŸåŒ–ã‚³ã‚¢: ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚­ãƒ£ãƒƒã‚·ãƒ¥                            
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Cache dependencies
        uses: actions/cache@v5
        id: deps-cache
        with:
          path: |
            ${{ steps.deps-cache-key.outputs.dir }}
            node_modules
          key: ${{ steps.deps-cache-key.outputs.key }}
          restore-keys: |
            ${{ runner.os }}-${{ matrix.package-manager }}-deps-
      
      - name: Install dependencies
        if: steps.deps-cache.outputs.cache-hit != 'true'
        run: |
          echo "ðŸ“¥ Installing dependencies..."
          ${{ env.INSTALL_CMD }}

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  ðŸ”‘ Playwrightã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Generate Playwright cache key
        id: playwright-cache-key
        run: |
          VERSION=$(jq -r '.devDependencies["@playwright/test"] // .dependencies["@playwright/test"]' package.json | sed 's/[\^~]//g')
          CACHE_KEY="playwright-${{ runner.os }}-${{ matrix.package-manager }}-${VERSION}-${{ env.PLAYWRIGHT_BROWSERS }}"
          echo "version=${VERSION}" >> $GITHUB_OUTPUT
          echo "key=${CACHE_KEY}" >> $GITHUB_OUTPUT
          echo "ðŸŽ­ Playwright Cache Key: ${CACHE_KEY}"

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  ðŸš€ é«˜é€ŸåŒ–ã‚³ã‚¢: Playwrightãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥                        
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Cache Playwright browsers
        uses: actions/cache@v5
        id: playwright-cache
        with:
          path: ~/.cache/ms-playwright
          key: ${{ steps.playwright-cache-key.outputs.key }}
      
      - name: Install Playwright browsers
        if: steps.playwright-cache.outputs.cache-hit != 'true'
        run: |
          echo "ðŸŽ­ Installing Playwright browsers..."
          ${{ env.PLAYWRIGHT_INSTALL_CMD }} ${{ env.PLAYWRIGHT_BROWSERS }}
      
      - name: Verify Playwright installation
        run: |
          echo "âœ… Verifying Playwright installation..."
          ls -la ~/.cache/ms-playwright || echo "âŒ Cache directory not found"
          ${{ env.PLAYWRIGHT_VERSION_CMD }}

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # â–ˆâ–ˆ Step 2: e2e-with-cache
  # â–ˆâ–ˆ â±ï¸  ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯è¨ˆæ¸¬: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ã‚Š
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  e2e-with-cache:
    needs: prepare-cache
    runs-on: ubuntu-latest
    strategy:
      matrix:
        package-manager: [bun, pnpm, npm]
        run: [1, 2, 3, 4, 5]

    steps:
      - uses: actions/checkout@v4
      
      - name: Record job start
        run: echo "JOB_START=$(date +%s)" >> $GITHUB_ENV

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  ðŸ“¦ Package Manager Setup (Composite Action)
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Setup Package Manager
        uses: ./.github/actions/setup-package-manager
        with:
          package-manager: ${{ matrix.package-manager }}
      
      - name: Record setup time
        run: echo "SETUP_TIME=$(date +%s)" >> $GITHUB_ENV

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  âš™ï¸ ç’°å¢ƒè¨­å®š (Environment Configuration)
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Configure Environment
        run: ./.github/scripts/configure-env.sh "${{ matrix.package-manager }}" true

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  ðŸ”‘ ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Generate dependency cache key
        id: deps-cache-key
        run: |
          LOCKFILE_HASH=$(sha256sum ${{ env.LOCKFILE }} | cut -d' ' -f1)
          CACHE_KEY="${{ runner.os }}-${{ matrix.package-manager }}-deps-${LOCKFILE_HASH}"
          echo "dir=${{ env.CACHE_DIR }}" >> $GITHUB_OUTPUT
          echo "key=${CACHE_KEY}" >> $GITHUB_OUTPUT
          echo "ðŸ“¦ Restoring with key: ${CACHE_KEY}"

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  ðŸš€ é«˜é€ŸåŒ–ã‚³ã‚¢: ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¾©å…ƒ
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Restore dependencies cache
        uses: actions/cache/restore@v5
        id: deps-cache
        with:
          path: |
            ${{ steps.deps-cache-key.outputs.dir }}
            node_modules
          key: ${{ steps.deps-cache-key.outputs.key }}
          restore-keys: |
            ${{ runner.os }}-${{ matrix.package-manager }}-deps-
      
      - name: Check cache status
        run: |
          if [ "${{ steps.deps-cache.outputs.cache-hit }}" = "true" ]; then
            echo "âœ… Dependencies cache HIT"
          else
            echo "âš ï¸ Dependencies cache MISS"
          fi

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  â±ï¸  ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯è¨ˆæ¸¬: ä¾å­˜ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Install dependencies
        run: |
          START=$(date +%s)
          ${{ env.INSTALL_CMD }}
          END=$(date +%s)
          echo "INSTALL_DEPS_DURATION=$((END - START))" >> $GITHUB_ENV

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  ðŸ”‘ Playwrightã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Generate Playwright cache key
        id: playwright-cache-key
        run: |
          START=$(date +%s)
          VERSION=$(jq -r '.devDependencies["@playwright/test"] // .dependencies["@playwright/test"]' package.json | sed 's/[\^~]//g')
          CACHE_KEY="playwright-${{ runner.os }}-${{ matrix.package-manager }}-${VERSION}-${{ env.PLAYWRIGHT_BROWSERS }}"
          echo "version=${VERSION}" >> $GITHUB_OUTPUT
          echo "key=${CACHE_KEY}" >> $GITHUB_OUTPUT
          END=$(date +%s)
          echo "GET_VERSION_DURATION=$((END - START))" >> $GITHUB_ENV
          echo "ðŸŽ­ Restoring with key: ${CACHE_KEY}"

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  ðŸš€ é«˜é€ŸåŒ–ã‚³ã‚¢: Playwrightãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¾©å…ƒ
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Restore Playwright browsers cache
        uses: actions/cache/restore@v5
        id: playwright-cache
        with:
          path: ~/.cache/ms-playwright
          key: ${{ steps.playwright-cache-key.outputs.key }}
      
      - name: Check Playwright cache status
        run: |
          if [ "${{ steps.playwright-cache.outputs.cache-hit }}" = "true" ]; then
            echo "âœ… Playwright cache HIT"
          else
            echo "âš ï¸ Playwright cache MISS"
          fi

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  ðŸŽ­ Playwrightãƒ–ãƒ©ã‚¦ã‚¶ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹æ™‚ã®ã¿)
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Install Playwright browsers
        if: steps.playwright-cache.outputs.cache-hit != 'true'
        run: |
          START=$(date +%s)
          echo "âš ï¸ Cache miss - Installing browsers with dependencies..."
          ${{ env.PLAYWRIGHT_INSTALL_CMD }} ${{ env.PLAYWRIGHT_BROWSERS }}
          END=$(date +%s)
          echo "INSTALL_BROWSERS_DURATION=$((END - START))" >> $GITHUB_ENV
      
      - name: Install Playwright system dependencies (cache hit)
        if: steps.playwright-cache.outputs.cache-hit == 'true'
        run: |
          START=$(date +%s)
          echo "âœ… Cache hit - Installing system dependencies only..."
          ${{ env.PLAYWRIGHT_INSTALL_DEPS_CMD }} ${{ env.PLAYWRIGHT_BROWSERS }}
          END=$(date +%s)
          echo "INSTALL_BROWSERS_DURATION=$((END - START))" >> $GITHUB_ENV

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  â±ï¸  ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯è¨ˆæ¸¬: E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Run E2E tests (run #${{ matrix.run }})
        id: playwright-tests
        continue-on-error: true
        run: |
          START=$(date +%s)
          ${{ env.PLAYWRIGHT_CMD }} test --workers=4
          END=$(date +%s)
          echo "TEST_DURATION=$((END - START))" >> $GITHUB_ENV
      
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  ðŸ’¾ ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯çµæžœä¿å­˜
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Save timing data
        id: save-timing
        if: always()
        run: |
          ./.github/scripts/save-timing-data.sh \
            "${{ matrix.package-manager }}" \
            "true" \
            "${{ matrix.run }}" \
            "$JOB_START" \
            "$SETUP_TIME" \
            "${INSTALL_DEPS_DURATION:-0}" \
            "${{ steps.deps-cache.outputs.cache-hit }}" \
            "${GET_VERSION_DURATION:-0}" \
            "${INSTALL_BROWSERS_DURATION:-0}" \
            "${{ steps.playwright-cache.outputs.cache-hit }}" \
            "${TEST_DURATION:-0}" \
            "${{ steps.playwright-tests.outcome }}"
          
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: timing-data-${{ matrix.package-manager }}-cached-${{ matrix.run }}
          path: timing-${{ matrix.package-manager }}-cached-${{ matrix.run }}.json
          retention-days: 7

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # â–ˆâ–ˆ Step 3: e2e-without-cache
  # â–ˆâ–ˆ â±ï¸  ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯è¨ˆæ¸¬: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  e2e-without-cache:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        package-manager: [bun, pnpm, npm]
        run: [1, 2, 3, 4, 5]
    steps:
      - uses: actions/checkout@v4
      
      - name: Record job start
        run: echo "JOB_START=$(date +%s)" >> $GITHUB_ENV

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  ðŸ“¦ Package Manager Setup (Composite Action)
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Setup Package Manager
        uses: ./.github/actions/setup-package-manager
        with:
          package-manager: ${{ matrix.package-manager }}
      
      - name: Record setup time
        run: echo "SETUP_TIME=$(date +%s)" >> $GITHUB_ENV

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  âš™ï¸ ç’°å¢ƒè¨­å®š (Environment Configuration)
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Configure Environment
        run: ./.github/scripts/configure-env.sh "${{ matrix.package-manager }}" true

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  â±ï¸  ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯è¨ˆæ¸¬: ä¾å­˜ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—)
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Install dependencies (no cache)
        run: |
          START=$(date +%s)
          ${{ env.INSTALL_CMD }}
          END=$(date +%s)
          echo "INSTALL_DEPS_DURATION=$((END - START))" >> $GITHUB_ENV
      
      - name: Get Playwright version
        id: playwright-version
        run: |
          START=$(date +%s)
          VERSION=$(jq -r '.devDependencies["@playwright/test"] // .dependencies["@playwright/test"]' package.json | sed 's/[\^~]//g')
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          END=$(date +%s)
          echo "GET_VERSION_DURATION=$((END - START))" >> $GITHUB_ENV
      
      - name: Install Playwright browsers (no cache)
        run: |
          START=$(date +%s)
          ${{ env.PLAYWRIGHT_INSTALL_CMD }} ${{ env.PLAYWRIGHT_BROWSERS }}
          END=$(date +%s)
          echo "INSTALL_BROWSERS_DURATION=$((END - START))" >> $GITHUB_ENV

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  â±ï¸  ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯è¨ˆæ¸¬: E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Run E2E tests (run #${{ matrix.run }})
        id: playwright-tests
        continue-on-error: true
        run: |
          START=$(date +%s)
          ${{ env.PLAYWRIGHT_CMD }} test
          END=$(date +%s)
          echo "TEST_DURATION=$((END - START))" >> $GITHUB_ENV
      
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      #  ðŸ’¾ ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯çµæžœä¿å­˜
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Save timing data
        id: save-timing
        if: always()
        run: |
          ./.github/scripts/save-timing-data.sh \
            "${{ matrix.package-manager }}" \
            "false" \
            "${{ matrix.run }}" \
            "$JOB_START" \
            "$SETUP_TIME" \
            "${INSTALL_DEPS_DURATION:-0}" \
            "false" \
            "${GET_VERSION_DURATION:-0}" \
            "${INSTALL_BROWSERS_DURATION:-0}" \
            "false" \
            "${TEST_DURATION:-0}" \
            "${{ steps.playwright-tests.outcome }}"
          
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: timing-data-${{ matrix.package-manager }}-nocache-${{ matrix.run }}
          path: timing-${{ matrix.package-manager }}-nocache-${{ matrix.run }}.json
          retention-days: 7

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # â–ˆâ–ˆ Step 4: summary
  # â–ˆâ–ˆ ðŸ“Š çµæžœé›†è¨ˆ: çµ±è¨ˆãƒ»æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  summary:
    needs: [e2e-with-cache, e2e-without-cache]
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Download all timing data
        uses: actions/download-artifact@v4
        with:
          pattern: timing-data-*
          merge-multiple: true
      
      - name: Calculate averages and generate summary
        run: |
          echo "## ðŸŽ­ Playwright E2E Test Performance Comparison" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          cat timing-*.json | jq -s '
            group_by(.package_manager, .cache_enabled) | 
            map({
              "package_manager": .[0].package_manager,
              "cache_enabled": .[0].cache_enabled,
              "runs": length,
              "averages": {
                "total": (map(.total) | add / length),
                "setup_pm": (map(.setup_pm) | add / length),
                "install_deps": (map(.install_deps) | add / length),
                "get_version": (map(.get_version) | add / length),
                "install_browsers": (map(.install_browsers) | add / length),
                "test_execution": (map(.test_execution) | add / length)
              },
              "cache_hits": {
                "deps": (map(select(.deps_cache_hit == "true")) | length),
                "playwright": (map(select(.playwright_cache_hit == "true")) | length)
              },
              "details": .
            })
          ' > summary.json
          
          echo "### ðŸ“Š Performance Comparison by Package Manager & Cache Strategy" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Package Manager | Cache | Runs | Setup | Install Deps | Browsers | Tests | Total Time |" >> $GITHUB_STEP_SUMMARY
          echo "|----------------|-------|------|-------|--------------|----------|-------|------------|" >> $GITHUB_STEP_SUMMARY
          
          cat summary.json | jq -r '
            # Sort: bun -> pnpm -> npm, cache enabled -> disabled
            sort_by(
              (if .package_manager == "bun" then 0 elif .package_manager == "pnpm" then 1 else 2 end),
              (if .cache_enabled then 0 else 1 end)
            ) | .[] | 
            "| **\(.package_manager)** | \(if .cache_enabled then "âœ… Enabled" else "âŒ Disabled" end) | \(.runs) | \(.averages.setup_pm | floor)s | \(.averages.install_deps | floor)s | \(.averages.install_browsers | floor)s | \(.averages.test_execution | floor)s | \(.averages.total | floor)s |"
          ' >> $GITHUB_STEP_SUMMARY
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸŽ¯ Cache Hit Rate" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Package Manager | Deps Cache Hit | Playwright Cache Hit |" >> $GITHUB_STEP_SUMMARY
          echo "|----------------|----------------|----------------------|" >> $GITHUB_STEP_SUMMARY
          
          cat summary.json | jq -r '
            map(select(.cache_enabled)) | 
            sort_by(if .package_manager == "bun" then 0 elif .package_manager == "pnpm" then 1 else 2 end) | 
            .[] | 
            "| **\(.package_manager)** | \(.cache_hits.deps)/\(.runs) | \(.cache_hits.playwright)/\(.runs) |"
          ' >> $GITHUB_STEP_SUMMARY
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ† Best Performance" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          cat summary.json | jq -r '
            sort_by(.averages.total) | 
            .[0] | 
            "**Fastest Configuration**: \(.package_manager) with cache \(if .cache_enabled then "enabled" else "disabled" end) - **\(.averages.total | floor)s** average total time"
          ' >> $GITHUB_STEP_SUMMARY
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“ˆ Cache Impact Analysis" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          cat summary.json | jq -r '
            group_by(.package_manager) |
            map({
              pm: .[0].package_manager,
              with_cache: (map(select(.cache_enabled)) | .[0].averages.total),
              without_cache: (map(select(.cache_enabled | not)) | .[0].averages.total)
            }) |
            sort_by(if .pm == "bun" then 0 elif .pm == "pnpm" then 1 else 2 end) |
            .[] |
            "- **\(.pm)**: Cache saves **\((.without_cache - .with_cache) | floor)s** (\(((.without_cache - .with_cache) / .without_cache * 100) | floor)% faster)"
          ' >> $GITHUB_STEP_SUMMARY
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“‹ Individual Run Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          for pm in bun pnpm npm; do
            echo "<details>" >> $GITHUB_STEP_SUMMARY
            echo "<summary>ðŸ“¦ $pm detailed results</summary>" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            
            cat summary.json | jq -r --arg pm "$pm" '
              map(select(.package_manager == $pm)) |
              sort_by(if .cache_enabled then 0 else 1 end) |
              .[] |
              "#### Cache: \(if .cache_enabled then "Enabled âœ…" else "Disabled âŒ" end)\n",
              "| Run | Setup | Deps | Browsers | Tests | Total |",
              "|-----|-------|------|----------|-------|-------|",
              (.details[] | "| \(.run) | \(.setup_pm)s | \(.install_deps)s | \(.install_browsers)s | \(.test_execution)s | \(.total)s |"),
              ""
            ' >> $GITHUB_STEP_SUMMARY
            
            echo "</details>" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          done