---
description: Git Hooksã«ã‚ˆã‚‹è‡ªå‹•pre-build-checkè¨­å®šã‚¬ã‚¤ãƒ‰
---

# Git Hooksè‡ªå‹•ãƒã‚§ãƒƒã‚¯è¨­å®š

## æ¦‚è¦

Git Hooksã‚’ä½¿ç”¨ã—ã¦ã€ã‚³ãƒŸãƒƒãƒˆæ™‚ã«è‡ªå‹•çš„ã«pre-build-checkã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¨ãƒ©ãƒ¼ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒŸãƒƒãƒˆã™ã‚‹ã“ã¨ã‚’é˜²ãã¾ã™ã€‚

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ–¹æ³•

### æ–¹æ³•1: Huskyã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰

#### 1. Huskyã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install --save-dev husky
```

#### 2. Huskyã®åˆæœŸåŒ–
```bash
npx husky install
```

#### 3. package.jsonã«prepareã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ 
```json
{
  "scripts": {
    "prepare": "husky install"
  }
}
```

#### 4. pre-commitãƒ•ãƒƒã‚¯ã®ä½œæˆ
```bash
npx husky add .husky/pre-commit "npm run type-check && npm run lint && echo 'âœ… Pre-commit checks passed!'"
```

ã¾ãŸã¯ã€æ‰‹å‹•ã§ `.husky/pre-commit` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š

```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# å‹ãƒã‚§ãƒƒã‚¯
echo "âš™ï¸  Type checking..."
npm run type-check || {
  echo "âŒ Type check failed. Please fix errors before committing."
  exit 1
}

# Lint
echo "ğŸ” Linting..."
npm run lint || {
  echo "âŒ Lint check failed. Run 'npm run lint -- --fix' to auto-fix."
  exit 1
}

echo "âœ… All pre-commit checks passed!"
```

#### 5. å®Ÿè¡Œæ¨©é™ã®ä»˜ä¸
```bash
chmod +x .husky/pre-commit
```

### æ–¹æ³•2: æ‰‹å‹•ã§Git Hooksã‚’è¨­å®š

#### 1. `.git/hooks/pre-commit` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
```bash
#!/bin/sh

echo "ğŸ” Running pre-commit checks..."

# å‹ãƒã‚§ãƒƒã‚¯
npm run type-check || exit 1

# Lint
npm run lint || exit 1

echo "âœ… All checks passed!"
```

#### 2. å®Ÿè¡Œæ¨©é™ã®ä»˜ä¸
```bash
chmod +x .git/hooks/pre-commit
```

### æ–¹æ³•3: npm scriptsã§çµ±åˆ

#### package.jsonã«è¿½åŠ 
```json
{
  "scripts": {
    "precommit": "npm run type-check && npm run lint",
    "prepush": "npm run build"
  }
}
```

## ãƒ•ãƒƒã‚¯ã®ç¨®é¡

### pre-commitï¼ˆæ¨å¥¨ï¼‰
- **ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ã‚³ãƒŸãƒƒãƒˆå®Ÿè¡Œæ™‚
- **ãƒã‚§ãƒƒã‚¯å†…å®¹**: å‹ãƒã‚§ãƒƒã‚¯ã€Lint
- **æ‰€è¦æ™‚é–“**: çŸ­ã„ï¼ˆæ•°ç§’ã€œ30ç§’ï¼‰

```bash
#!/bin/sh
npm run type-check && npm run lint
```

### pre-pushï¼ˆã‚ˆã‚Šå³æ ¼ï¼‰
- **ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: Pushå®Ÿè¡Œæ™‚
- **ãƒã‚§ãƒƒã‚¯å†…å®¹**: å‹ãƒã‚§ãƒƒã‚¯ã€Lintã€ãƒ“ãƒ«ãƒ‰
- **æ‰€è¦æ™‚é–“**: é•·ã„ï¼ˆ1ã€œ3åˆ†ï¼‰

```bash
#!/bin/sh
npm run type-check && npm run lint && npm run build
```

### commit-msg
- **ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆæ™‚
- **ãƒã‚§ãƒƒã‚¯å†…å®¹**: Conventional Commitså½¢å¼ã®ãƒã‚§ãƒƒã‚¯

```bash
#!/bin/sh
# commitlint ã‚’ä½¿ç”¨
npx --no -- commitlint --edit "$1"
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ•ãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œãªã„å ´åˆ

#### åŸå› 1: å®Ÿè¡Œæ¨©é™ãŒãªã„
```bash
# ç¢ºèª
ls -la .husky/pre-commit

# æ¨©é™ä»˜ä¸
chmod +x .husky/pre-commit
```

#### åŸå› 2: HuskyãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ãªã„
```bash
npx husky install
```

#### åŸå› 3: Git HooksãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹
```bash
# ç¢ºèª
git config core.hooksPath

# Huskyã®ãƒ•ãƒƒã‚¯ãƒ‘ã‚¹ã‚’è¨­å®š
git config core.hooksPath .husky
```

### ãƒ•ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ãŸã„å ´åˆï¼ˆéæ¨å¥¨ï¼‰

```bash
# --no-verify ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ï¼ˆç·Šæ€¥æ™‚ã®ã¿ï¼‰
git commit --no-verify -m "emergency fix"

# âš ï¸ é€šå¸¸ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ï¼
```

## Lint-stagedã¨ã®çµ„ã¿åˆã‚ã›ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€å®Ÿè¡Œé€Ÿåº¦ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚

### 1. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install --save-dev lint-staged
```

### 2. package.jsonã«è¨­å®šã‚’è¿½åŠ 
```json
{
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ]
  }
}
```

### 3. pre-commitãƒ•ãƒƒã‚¯ã‚’æ›´æ–°
```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx lint-staged
npm run type-check
```

## CI/CDã¨ã®çµ±åˆ

### GitHub Actionsä¾‹
```yaml
# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Type check
        run: npm run type-check
      
      - name: Lint
        run: npm run lint
      
      - name: Build
        run: npm run build
```

## ãƒãƒ¼ãƒ å…¨ä½“ã§ã®å°å…¥

### 1. ãƒªãƒã‚¸ãƒˆãƒªã«è¨­å®šã‚’ã‚³ãƒŸãƒƒãƒˆ
```bash
git add .husky/
git add package.json
git commit -m "chore: add git hooks for pre-commit checks"
git push
```

### 2. ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¸ã®å‘¨çŸ¥
```markdown
## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ï¼ˆæ–°ãƒ¡ãƒ³ãƒãƒ¼å‘ã‘ï¼‰

1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd journee

2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

3. Git Hooksã®åˆæœŸåŒ–ï¼ˆè‡ªå‹•ã§å®Ÿè¡Œã•ã‚Œã¾ã™ï¼‰
npm run prepare

4. å‹•ä½œç¢ºèª
git commit --allow-empty -m "test: verify hooks"
# â†’ å‹ãƒã‚§ãƒƒã‚¯ãƒ»LintãŒå®Ÿè¡Œã•ã‚Œã‚Œã°OK
```

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### DOï¼ˆæ¨å¥¨ï¼‰
- âœ… pre-commitã§è»½é‡ãªãƒã‚§ãƒƒã‚¯ï¼ˆå‹ãƒã‚§ãƒƒã‚¯ã€Lintï¼‰
- âœ… pre-pushã§é‡ã„ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ“ãƒ«ãƒ‰ï¼‰
- âœ… ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åˆ†ã‹ã‚Šã‚„ã™ã
- âœ… ãƒãƒ¼ãƒ å…¨ä½“ã§çµ±ä¸€ã—ãŸãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨
- âœ… CI/CDã¨åŒã˜ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ

### DON'Tï¼ˆéæ¨å¥¨ï¼‰
- âŒ ãƒ•ãƒƒã‚¯ã‚’é »ç¹ã«ã‚¹ã‚­ãƒƒãƒ—ï¼ˆ`--no-verify`ï¼‰
- âŒ éåº¦ã«é‡ã„ãƒã‚§ãƒƒã‚¯ï¼ˆpre-commitã§æ•°åˆ†ã‹ã‹ã‚‹ï¼‰
- âŒ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãªã—ã§å¤±æ•—
- âŒ ãƒ­ãƒ¼ã‚«ãƒ«ã ã‘ã®è¨­å®šï¼ˆå…±æœ‰ã—ãªã„ï¼‰

## ã¾ã¨ã‚

Git Hooksã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ï¼š
- âœ… è‡ªå‹•çš„ã«pre-build-checkãŒå®Ÿè¡Œã•ã‚Œã‚‹
- âœ… ã‚¨ãƒ©ãƒ¼ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒŸãƒƒãƒˆã§ããªã„
- âœ… CI/CDã‚¨ãƒ©ãƒ¼ã‚’æœªç„¶ã«é˜²ã’ã‚‹
- âœ… ãƒãƒ¼ãƒ å…¨ä½“ã®ã‚³ãƒ¼ãƒ‰å“è³ªãŒå‘ä¸Š
- âœ… ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚é–“ãŒçŸ­ç¸®ã•ã‚Œã‚‹

**æ¨å¥¨è¨­å®š**: Husky + pre-commitãƒ•ãƒƒã‚¯ï¼ˆå‹ãƒã‚§ãƒƒã‚¯ + Lintï¼‰

è©³ç´°ã¯ [.cursor/rules/mandatory-pre-build-check.mdc](mdc:.cursor/rules/mandatory-pre-build-check.mdc) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
