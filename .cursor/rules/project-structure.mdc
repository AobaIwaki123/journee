---
alwaysApply: true
---

# Journee ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
AIã¨ã¨ã‚‚ã«æ—…ã®ã—ãŠã‚Šã‚’ä½œæˆã™ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚ãƒãƒ£ãƒƒãƒˆå½¢å¼ã§æ—…è¡Œè¨ˆç”»ã‚’ç«‹ã¦ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã—ãŠã‚Šã‚’ç”Ÿæˆã—ã¾ã™ã€‚

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Next.js 14+ (App Router)
- **è¨€èª**: TypeScript
- **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: Tailwind CSS
- **çŠ¶æ…‹ç®¡ç†**: Zustand
- **èªè¨¼**: NextAuth.js (Google OAuth)
- **UI**: lucide-react (ã‚¢ã‚¤ã‚³ãƒ³)
- **é–‹ç™ºç’°å¢ƒ**: Docker

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

### `/app` - Next.js App Router
- [app/page.tsx](mdc:app/page.tsx) - ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ï¼ˆèªè¨¼ä¿è­·ã€ãƒãƒ£ãƒƒãƒˆ40% / ã—ãŠã‚Š60%ï¼‰
- [app/layout.tsx](mdc:app/layout.tsx) - ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆAuthProviderçµ±åˆæ¸ˆã¿ï¼‰
- [app/globals.css](mdc:app/globals.css) - ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
- `/app/login` - ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
  - [page.tsx](mdc:app/login/page.tsx) - Googleãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
- `/app/privacy` - ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ï¼ˆPhase 2å®Ÿè£…æ¸ˆã¿ï¼‰
- `/app/terms` - åˆ©ç”¨è¦ç´„ï¼ˆPhase 2å®Ÿè£…æ¸ˆã¿ï¼‰
- `/app/api` - APIãƒ«ãƒ¼ãƒˆ
  - `/auth/[...nextauth]` - NextAuth.jsèªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    - [route.ts](mdc:app/api/auth/[...nextauth]/route.ts) - èªè¨¼API
  - `/health` - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
    - [route.ts](mdc:app/api/health/route.ts) - ã‚µãƒ¼ãƒ“ã‚¹ç¨¼åƒçŠ¶æ³ç¢ºèª
  - `/user/me` - ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
    - [route.ts](mdc:app/api/user/me/route.ts) - ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ï¼ˆèªè¨¼å¿…é ˆï¼‰

### `/components` - Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `/auth` - èªè¨¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆPhase 2å®Ÿè£…æ¸ˆã¿ï¼‰
  - [AuthProvider.tsx](mdc:components/auth/AuthProvider.tsx) - NextAuthã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
  - [LoginButton.tsx](mdc:components/auth/LoginButton.tsx) - Googleãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³
  - [UserMenu.tsx](mdc:components/auth/UserMenu.tsx) - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰
- `/chat` - ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
  - [ChatBox.tsx](mdc:components/chat/ChatBox.tsx) - ãƒãƒ£ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠ
  - [MessageList.tsx](mdc:components/chat/MessageList.tsx) - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§
  - [MessageInput.tsx](mdc:components/chat/MessageInput.tsx) - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›
  - [AISelector.tsx](mdc:components/chat/AISelector.tsx) - AIãƒ¢ãƒ‡ãƒ«é¸æŠ
- `/itinerary` - ã—ãŠã‚Šæ©Ÿèƒ½
  - [ItineraryPreview.tsx](mdc:components/itinerary/ItineraryPreview.tsx) - ã—ãŠã‚Šãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
  - [DaySchedule.tsx](mdc:components/itinerary/DaySchedule.tsx) - æ—¥ç¨‹è¡¨ç¤º
  - [SpotCard.tsx](mdc:components/itinerary/SpotCard.tsx) - è¦³å…‰ã‚¹ãƒãƒƒãƒˆã‚«ãƒ¼ãƒ‰
- `/layout` - ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
  - [Header.tsx](mdc:components/layout/Header.tsx) - ãƒ˜ãƒƒãƒ€ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆèªè¨¼æ©Ÿèƒ½çµ±åˆæ¸ˆã¿ï¼‰
- `/ui` - å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  - [LoadingSpinner.tsx](mdc:components/ui/LoadingSpinner.tsx) - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼

### `/lib` - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»ãƒ­ã‚¸ãƒƒã‚¯
- `/auth` - èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆPhase 2å®Ÿè£…æ¸ˆã¿ï¼‰
  - [auth-options.ts](mdc:lib/auth/auth-options.ts) - NextAuthè¨­å®šï¼ˆGoogle OAuth, JWTæˆ¦ç•¥ï¼‰
  - [session.ts](mdc:lib/auth/session.ts) - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆgetSession, getCurrentUserï¼‰
  - [README.md](mdc:lib/auth/README.md) - èªè¨¼æ©Ÿèƒ½ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- `/store` - ZustandçŠ¶æ…‹ç®¡ç†
  - [useStore.ts](mdc:lib/store/useStore.ts) - ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ãƒˆã‚¢
- `/ai` - AIçµ±åˆï¼ˆPhase 3ã§å®Ÿè£…äºˆå®šï¼‰

### `/types` - TypeScriptå‹å®šç¾©
- [chat.ts](mdc:types/chat.ts) - ãƒãƒ£ãƒƒãƒˆé–¢é€£ã®å‹
- [itinerary.ts](mdc:types/itinerary.ts) - ã—ãŠã‚Šé–¢é€£ã®å‹
- [auth.ts](mdc:types/auth.ts) - èªè¨¼é–¢é€£ã®å‹ï¼ˆNextAuthæ‹¡å¼µå‹å®šç¾©ï¼‰
- [api.ts](mdc:types/api.ts) - APIå…±é€šå‹å®šç¾©ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ã€ã‚¨ãƒ©ãƒ¼ï¼‰

### `/public` - é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
- `/images` - ç”»åƒãƒ»ã‚¢ã‚¤ã‚³ãƒ³

### `/docs` - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [API.md](mdc:docs/API.md) - APIä»•æ§˜æ›¸
- [PHASE2_IMPLEMENTATION.md](mdc:docs/PHASE2_IMPLEMENTATION.md) - Phase 2å®Ÿè£…ãƒ¬ãƒãƒ¼ãƒˆ
- [INTEGRATION_COMPLETE.md](mdc:docs/INTEGRATION_COMPLETE.md) - Phase 1 & 2çµ±åˆãƒ¬ãƒãƒ¼ãƒˆ
- [PHASE2_TESTING_GUIDE.md](mdc:docs/PHASE2_TESTING_GUIDE.md) - ãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰

### ãã®ä»–
- [middleware.ts](mdc:middleware.ts) - èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆä¿è­·ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆè‡ªå‹•ãƒã‚§ãƒƒã‚¯ï¼‰

## é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º
- âœ… **Phase 1ï¼ˆå®Œäº†ï¼‰**: åŸºç¤æ§‹ç¯‰ï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€ãƒãƒ£ãƒƒãƒˆUIã€çŠ¶æ…‹ç®¡ç†ï¼‰
- âœ… **Phase 2ï¼ˆå®Œäº†ï¼‰**: èªè¨¼æ©Ÿèƒ½ï¼ˆNextAuth.js + Google OAuthï¼‰
- ğŸ”„ **Phase 3ï¼ˆæ¬¡ï¼‰**: AIçµ±åˆï¼ˆGemini APIï¼‰
- ğŸ“‹ **Phase 4-11**: ãã®ä»–æ©Ÿèƒ½ï¼ˆè©³ç´°ã¯[README.md](mdc:README.md)å‚ç…§ï¼‰

## èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ï¼ˆPhase 2å®Ÿè£…æ¸ˆã¿ï¼‰
### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **èªè¨¼æˆ¦ç•¥**: JWTï¼ˆJSON Web Tokenï¼‰
- **ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼**: Google OAuth 2.0
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³æœŸé™**: 30æ—¥é–“
- **ä¿å­˜**: HTTPOnly Cookieï¼ˆXSSå¯¾ç­–ï¼‰

### èªè¨¼ãƒ•ãƒ­ãƒ¼
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ `/api/auth/signin` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. Google OAuthç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
3. èªè¨¼æˆåŠŸå¾Œã€JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã¦Cookieã«ä¿å­˜
4. ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ˜ãƒ«ãƒ‘ãƒ¼
```typescript
import { getCurrentUser } from '@/lib/auth/session'

// Server Component / Route Handler
const user = await getCurrentUser()
if (!user) {
  return new Response('Unauthorized', { status: 401 })
}
```

### èªè¨¼ä¿è­·
- **ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢**: `/api/*`ï¼ˆä¸€éƒ¨é™¤å¤–ï¼‰ã€ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¯è‡ªå‹•èªè¨¼ãƒã‚§ãƒƒã‚¯
- **æœªèªè¨¼æ™‚**: è‡ªå‹•çš„ã« `/login` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

### èªè¨¼API
| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ | èªè¨¼ |
|------------|------|------|
| `GET /api/auth/signin` | ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ | ä¸è¦ |
| `GET /api/auth/signout` | ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ | å¿…è¦ |
| `GET /api/auth/session` | ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±å–å¾— | ä¸è¦ |
| `GET /api/user/me` | ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾— | å¿…è¦ |
| `GET /api/health` | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ | ä¸è¦ |

è©³ç´°ã¯ [docs/API.md](mdc:docs/API.md) ã¨ [lib/auth/README.md](mdc:lib/auth/README.md) å‚ç…§ã€‚

## é‡è¦ãªãƒ•ã‚¡ã‚¤ãƒ«
- [package.json](mdc:package.json) - ä¾å­˜é–¢ä¿‚ãƒ»npm scripts
- [tsconfig.json](mdc:tsconfig.json) - TypeScriptè¨­å®š
- [tailwind.config.ts](mdc:tailwind.config.ts) - Tailwind CSSè¨­å®š
- [README.md](mdc:README.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®è©³ç´°
- [PHASE1_SUMMARY.md](mdc:PHASE1_SUMMARY.md) - Phase 1å®Œäº†ã‚µãƒãƒªãƒ¼
- [docs/INTEGRATION_COMPLETE.md](mdc:docs/INTEGRATION_COMPLETE.md) - Phase 1 & 2çµ±åˆãƒ¬ãƒãƒ¼ãƒˆ

## çŠ¶æ…‹ç®¡ç†ï¼ˆZustandï¼‰
- ãƒãƒ£ãƒƒãƒˆçŠ¶æ…‹: `messages`, `isLoading`
- ã—ãŠã‚ŠçŠ¶æ…‹: `currentItinerary`
- UIçŠ¶æ…‹: `selectedAI`ï¼ˆgemini / claudeï¼‰

å…¨ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ `useStore()` ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã€‚

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆåŸå‰‡
1. **Client Components**: 'use client'ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–å¿…é ˆï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªUIï¼‰
2. **Server Components**: èªè¨¼ãƒã‚§ãƒƒã‚¯ãªã©ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å‡¦ç†ãŒå¿…è¦ãªå ´åˆ
3. **ãƒ•ã‚¡ã‚¤ãƒ«å‘½å**: PascalCaseï¼ˆä¾‹: ChatBox.tsxï¼‰
4. **export**: named exportï¼ˆä¾‹: `export const ChatBox: React.FC = () => {}`ï¼‰
5. **å‹å®‰å…¨æ€§**: ã™ã¹ã¦ã®propsã¨stateã«å‹å®šç¾©
6. **å†åˆ©ç”¨æ€§**: å˜ä¸€è²¬ä»»ã®åŸå‰‡ã«å¾“ã†

## Dockerç’°å¢ƒ
- `npm run docker:start` - é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
- `npm run docker:stop` - åœæ­¢
- `npm run docker:logs` - ãƒ­ã‚°ç¢ºèª
- è©³ç´°ã¯[DOCKER.md](mdc:DOCKER.md)å‚ç…§

## ç’°å¢ƒå¤‰æ•°ï¼ˆ`.env.local`ï¼‰
```env
# èªè¨¼ï¼ˆPhase 2ï¼‰
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your_secret_here
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret

# AIçµ±åˆï¼ˆPhase 3ã§è¿½åŠ äºˆå®šï¼‰
GEMINI_API_KEY=your_gemini_api_key
```

`.env.example` ã‚’å‚ç…§ã—ã¦è¨­å®šã€‚
