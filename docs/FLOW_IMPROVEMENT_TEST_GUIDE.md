# フロー改善 統合テストガイド

## テスト環境

- **開発サーバー**: `npm run dev` で起動
- **URL**: http://localhost:3000
- **必要な環境変数**: GEMINI_API_KEY

## テストシナリオ

### シナリオ1: 基本情報収集フロー（collecting_basic）

**目的**: 行き先と日数の収集を確認

**手順**:
1. アプリを開く
2. チャットで「京都に3日間行きたいです」と入力
3. **期待される動作**:
   - AIが行き先と日数を確認
   - RequirementsChecklistに以下が表示:
     - ✅ 行き先: 京都
     - ✅ 日程: 3日間
   - プログレスバーが10%程度に
   - 「詳細情報を収集」ボタンがアクティブに

**確認項目**:
- [ ] 行き先が正しく抽出されている
- [ ] 日数が正しく抽出されている
- [ ] チェックリストが表示されている
- [ ] ボタンが適切な状態になっている

---

### シナリオ2: 詳細情報収集フロー（collecting_detailed）

**目的**: LLM主導の対話的情報収集を確認

**手順**:
1. シナリオ1の続きから
2. 「詳細情報を収集」ボタンをクリック
3. **期待される動作**:
   - フェーズが`collecting_detailed`に遷移
   - AIが同行者について質問（「誰と行かれますか？」）
   - ヘルプテキストが「AIに興味、予算、同行者などを伝えてください」に変更

4. 「彼女と二人で行きます」と入力
5. **期待される動作**:
   - AIが興味について質問（「どんなことに興味がありますか？」）
   - RequirementsChecklistが更新:
     - ✅ 同行者: カップル
   - プログレスバーが20%程度に

6. 「寺社巡りとグルメを楽しみたいです」と入力
7. **期待される動作**:
   - AIが次の質問（予算や具体的な場所など）
   - RequirementsChecklistが更新:
     - ✅ 興味: 寺社巡り、グルメ
   - プログレスバーが上昇

8. （オプション）「予算は5万円くらいです」と入力
9. **期待される動作**:
   - RequirementsChecklistが更新:
     - ✅ 予算: 50000円
   - 充足率が60%以上に
   - 「骨組みを作成」ボタンが緑色でパルスアニメーション

**確認項目**:
- [ ] フェーズが自動的に遷移している
- [ ] AIが1つずつ質問している
- [ ] チェックリストがリアルタイム更新される
- [ ] 充足率が正しく計算されている
- [ ] ボタンが動的にスタイル変更される

---

### シナリオ3: 骨組み作成フロー（skeleton）

**目的**: 収集した情報を基に骨組みが作成されることを確認

**手順**:
1. シナリオ2の続きから
2. 「骨組みを作成」ボタンをクリック
3. **期待される動作**:
   - フェーズが`skeleton`に遷移
   - AIが各日のテーマを生成
   - しおりプレビューに各日のテーマが表示:
     - 1日目: [テーマ] (例: 東山エリア - 歴史と文化)
     - 2日目: [テーマ]
     - 3日目: [テーマ]
   - 各日のstatus: "skeleton"
   - 具体的なスポットはまだなし

**確認項目**:
- [ ] 収集した情報（同行者、興味）が反映されている
- [ ] 各日に適切なテーマが設定されている
- [ ] 具体的なスポットはまだ生成されていない
- [ ] JSONのphaseが"skeleton"になっている

---

### シナリオ4: 日程詳細化フロー（detailing）

**目的**: 骨組みを基に各日の詳細が生成されることを確認

**手順**:
1. シナリオ3の続きから
2. 「日程の詳細化」ボタンをクリック
3. **期待される動作**:
   - フェーズが`detailing`に遷移
   - 1日目の詳細が生成される
   - 各スポットに時間、費用、説明が追加される
   - プログレスバーが更新される

4. 「次の日へ」ボタンをクリック
5. **期待される動作**:
   - 2日目の詳細が生成される
   - プログレスバーが増加

6. 「次の日へ」ボタンをクリック
7. **期待される動作**:
   - 3日目の詳細が生成される

8. 「完成」ボタンをクリック
9. **期待される動作**:
   - フェーズが`completed`に遷移
   - プログレスバーが100%に
   - 完成メッセージが表示

**確認項目**:
- [ ] 各日の詳細が段階的に生成される
- [ ] スポットが実在する場所である
- [ ] 時間が現実的に設定されている
- [ ] 興味（寺社巡り、グルメ）が反映されている

---

## エッジケーステスト

### エッジケース1: 情報が不足したまま進む

**手順**:
1. 「東京」とだけ入力（日数なし）
2. 「詳細情報を収集」ボタンをクリック
3. **期待される動作**:
   - 警告ダイアログが表示される
   - 不足情報（日数）が明示される
   - 「情報を追加する」または「このまま進む」を選択可能

**確認項目**:
- [ ] 必須情報の不足が検出される
- [ ] 警告が適切に表示される
- [ ] 強制的に進むこともできる

### エッジケース2: フェーズを戻る

**手順**:
1. collecting_detailed → skeleton に進む
2. リセットボタンをクリック
3. **期待される動作**:
   - 確認ダイアログが表示される
   - フェーズがinitialに戻る
   - チェックリストがクリアされる

**確認項目**:
- [ ] リセットが正しく動作する
- [ ] 確認ダイアログが表示される

### エッジケース3: LocalStorageの永続化

**手順**:
1. collecting_detailed フェーズまで進む
2. ページをリロード
3. **期待される動作**:
   - フェーズが保持されている
   - チェックリストの情報が復元される
   - チャット履歴が保持されている

**確認項目**:
- [ ] フェーズが保持される
- [ ] 情報が失われない

---

## パフォーマンステスト

### テスト1: チェックリスト更新のパフォーマンス

**確認項目**:
- [ ] メッセージ入力時にラグがない（< 100ms）
- [ ] チェックリスト更新がスムーズ
- [ ] プログレスバーのアニメーションが滑らか

### テスト2: フェーズ遷移のパフォーマンス

**確認項目**:
- [ ] フェーズ遷移が即座に反映される
- [ ] UI更新に遅延がない
- [ ] ボタンの状態変更がスムーズ

---

## 自動テスト実行

```bash
# 開発サーバー起動
npm run dev

# 別ターミナルでE2Eテスト実行（将来）
npm run test:e2e
```

---

## テスト結果記録

### テスト実施日: ____________________

| シナリオ | 結果 | 備考 |
|---------|------|------|
| シナリオ1: collecting_basic | ⬜ Pass / ⬜ Fail | |
| シナリオ2: collecting_detailed | ⬜ Pass / ⬜ Fail | |
| シナリオ3: skeleton | ⬜ Pass / ⬜ Fail | |
| シナリオ4: detailing | ⬜ Pass / ⬜ Fail | |
| エッジケース1 | ⬜ Pass / ⬜ Fail | |
| エッジケース2 | ⬜ Pass / ⬜ Fail | |
| エッジケース3 | ⬜ Pass / ⬜ Fail | |
| パフォーマンス1 | ⬜ Pass / ⬜ Fail | |
| パフォーマンス2 | ⬜ Pass / ⬜ Fail | |

---

## 既知の問題

（テスト中に発見された問題をここに記録）

---

## 改善提案

（テスト中に気づいた改善点をここに記録）
