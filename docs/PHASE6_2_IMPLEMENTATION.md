# Phase 6.2: Claude APIçµ±åˆ å®Ÿè£…å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

**å®Ÿè£…æ—¥**: 2025-10-07  
**Phase**: 6.2 - Claude APIå®Œå…¨çµ±åˆ  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†

---

## ğŸ“‹ å®Ÿè£…æ¦‚è¦

Phase 6.2ã§ã¯ã€Anthropic Claude APIã®å®Œå…¨çµ±åˆã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚Gemini APIã¨åŒç­‰ã®æ©Ÿèƒ½ã‚’æŒã¤Claudeã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å®Ÿè£…ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAIãƒ¢ãƒ‡ãƒ«ã‚’è‡ªç”±ã«åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

### å®Ÿè£…å†…å®¹

1. âœ… **Anthropic SDKã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«** (`@anthropic-ai/sdk`)
2. âœ… **ClaudeClientã‚¯ãƒ©ã‚¹ã®å®Ÿè£…** (éã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œ)
3. âœ… **Claudeç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰**
4. âœ… **ãƒãƒ£ãƒƒãƒˆAPIãƒ«ãƒ¼ãƒˆã®Claudeå¯¾å¿œ**
5. âœ… **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®Claudeå¯¾å¿œ** (MessageInput, APIClient)
6. âœ… **AISelectorè­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‰Šé™¤**

---

## ğŸ—‚ï¸ æ–°è¦ãƒ»æ›´æ–°ãƒ•ã‚¡ã‚¤ãƒ«

### æ›´æ–°ãƒ•ã‚¡ã‚¤ãƒ«

#### 1. `lib/ai/claude.ts`
**å¤‰æ›´**: Phase 6.1ã®éª¨çµ„ã¿ã‹ã‚‰å®Œå…¨å®Ÿè£…ã¸

**ä¸»è¦ã‚¯ãƒ©ã‚¹: ClaudeClient**
```typescript
class ClaudeClient {
  private client: Anthropic;
  private model: string = 'claude-sonnet-4-5-20250929';

  // éã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒãƒ£ãƒƒãƒˆ
  async chat(userMessage, chatHistory, currentItinerary);
  
  // ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒãƒ£ãƒƒãƒˆ
  async *chatStream(userMessage, chatHistory, currentItinerary);
  
  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰
  private buildPrompt(userMessage, chatHistory, currentItinerary);
  
  // Claude APIå½¢å¼ã¸ã®å¤‰æ›
  private convertToClaudeMessages(chatHistory, userPrompt);
}
```

**ä¸»è¦é–¢æ•°**:
- `validateClaudeApiKey(apiKey)`: å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ã§æ¤œè¨¼
- `sendClaudeMessage()`: éã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°é€ä¿¡
- `streamClaudeMessage()`: ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°é€ä¿¡

**ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**:
- 401: APIã‚­ãƒ¼ç„¡åŠ¹
- 429: ãƒ¬ãƒ¼ãƒˆåˆ¶é™
- 500: ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼

#### 2. `app/api/chat/route.ts`
**è¿½åŠ æ©Ÿèƒ½**: Claudeå¯¾å¿œã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**æ›´æ–°å†…å®¹**:
- Claude APIã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆè¿½åŠ 
- Claudeç”¨ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ã®è¿½åŠ :
  - `handleClaudeNonStreamingResponse()`
  - `handleClaudeStreamingResponse()`
- ãƒ¢ãƒ‡ãƒ«åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã®æ›´æ–°
- Geminiç”¨ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®ãƒªãƒãƒ¼ãƒ :
  - `handleNonStreamingResponse()` â†’ `handleGeminiNonStreamingResponse()`
  - `handleStreamingResponse()` â†’ `handleGeminiStreamingResponse()`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼**:
```
POST /api/chat
  â†“
model === 'claude' ?
  â†“ YES
  claudeApiKeyç¢ºèª
  â†“
  stream ? handleClaudeStreamingResponse : handleClaudeNonStreamingResponse
  â†“ NO
  stream ? handleGeminiStreamingResponse : handleGeminiNonStreamingResponse
```

#### 3. `lib/utils/api-client.ts`
**æ›´æ–°**: Claudeå¯¾å¿œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ 

**å¤‰æ›´å†…å®¹**:
```typescript
// å¤‰æ›´å‰
export async function* sendChatMessageStream(
  message: string,
  chatHistory?: ChatMessage[],
  currentItinerary?: ItineraryData
)

// å¤‰æ›´å¾Œ
export async function* sendChatMessageStream(
  message: string,
  chatHistory?: ChatMessage[],
  currentItinerary?: ItineraryData,
  model?: 'gemini' | 'claude',
  claudeApiKey?: string
)
```

#### 4. `components/chat/MessageInput.tsx`
**æ›´æ–°**: Claude APIã‚­ãƒ¼ã‚’APIã«æ¸¡ã™

**å¤‰æ›´ç®‡æ‰€**:
```typescript
// ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‡¦ç†
for await (const chunk of sendChatMessageStream(
  userMessage.content,
  chatHistory,
  currentItinerary || undefined,
  selectedAI,           // â† è¿½åŠ : é¸æŠã•ã‚ŒãŸAIãƒ¢ãƒ‡ãƒ«
  claudeApiKey || undefined  // â† è¿½åŠ : Claude APIã‚­ãƒ¼
)) {
  // ...
}
```

#### 5. `components/chat/AISelector.tsx`
**æ›´æ–°**: è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‰Šé™¤

**å‰Šé™¤å†…å®¹**:
```typescript
// å‰Šé™¤: Phase 6.2æœªå®Ÿè£…è­¦å‘Š
{selectedAI === 'claude' && (
  <div className="flex items-center space-x-1 text-yellow-600">
    <AlertCircle className="w-4 h-4" />
    <span className="text-xs">Phase 6.2ã§å®Ÿè£…äºˆå®š</span>
  </div>
)}
```

#### 6. `package.json`
**è¿½åŠ **: Anthropic SDKã®ä¾å­˜é–¢ä¿‚

```json
"dependencies": {
  "@anthropic-ai/sdk": "^0.65.0",
  // ...
}
```

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### Claude APIã®çµ±åˆæ–¹å¼

Phase 6.2ã§ã¯ã€**Gemini APIã¨å®Œå…¨ã«åŒã˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**ã‚’æŒã¤ClaudeClientã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å¤‰æ›´ã‚’æœ€å°é™ã«æŠ‘ãˆã¾ã—ãŸã€‚

#### å…±é€šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

```typescript
// Gemini
const geminiClient = new GeminiClient();
geminiClient.chat(message, history, itinerary);
geminiClient.chatStream(message, history, itinerary);

// Claude
const claudeClient = new ClaudeClient(apiKey);
claudeClient.chat(message, history, itinerary);
claudeClient.chatStream(message, history, itinerary);
```

#### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰ã®çµ±ä¸€

ä¸¡æ–¹ã®AIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã€å…±é€šã®`prompts.ts`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ï¼š
- `SYSTEM_PROMPT`: åŸºæœ¬çš„ãªå½¹å‰²å®šç¾©
- `createUpdatePrompt()`: ã—ãŠã‚Šæ›´æ–°ç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
- `formatChatHistory()`: ä¼šè©±å±¥æ­´ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- `parseAIResponse()`: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‘ãƒ¼ã‚¹ï¼ˆJSONæŠ½å‡ºï¼‰
- `mergeItineraryData()`: ã—ãŠã‚Šãƒ‡ãƒ¼ã‚¿ã®ãƒãƒ¼ã‚¸

---

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### Claudeä½¿ç”¨æ™‚ã®å®Œå…¨ãªãƒ•ãƒ­ãƒ¼

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
  â†“
MessageInput
  â†“
selectedAI: 'claude'
claudeApiKey: ä¿å­˜æ¸ˆã¿ã‚­ãƒ¼
  â†“
sendChatMessageStream(message, history, itinerary, 'claude', apiKey)
  â†“
POST /api/chat {
  message,
  chatHistory,
  currentItinerary,
  model: 'claude',
  claudeApiKey,
  stream: true
}
  â†“
handleClaudeStreamingResponse()
  â†“
streamClaudeMessage(apiKey, message, chatHistory, currentItinerary)
  â†“
ClaudeClient.chatStream()
  â†“
Anthropic API (ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°)
  â†“
Server-Sent Events (SSE)
  â†“
MessageInput (ãƒãƒ£ãƒ³ã‚¯å—ä¿¡)
  â†“
{type: 'message', content: '...'}  â†’ ç”»é¢ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
{type: 'itinerary', itinerary: {...}} â†’ ã—ãŠã‚Šæ›´æ–°
{type: 'done'} â†’ å®Œäº†
  â†“
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã«è¿½åŠ 
```

---

## ğŸ†š Gemini vs Claude æ¯”è¼ƒ

| é …ç›® | Gemini 2.5 Pro | Claude 4.5 Sonnet |
|------|----------------|-------------------|
| **APIã‚­ãƒ¼** | ç’°å¢ƒå¤‰æ•° | ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ï¼ˆLocalStorageï¼‰ |
| **èªè¨¼æ–¹å¼** | ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæä¾› |
| **ãƒ¢ãƒ‡ãƒ«å** | `gemini-2.5-pro` | `claude-sonnet-4-5-20250929` |
| **æœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³** | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | 4096 |
| **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°** | âœ… å¯¾å¿œ | âœ… å¯¾å¿œ |
| **ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ** | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å«ã‚ã‚‹ | å°‚ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ |
| **ä¼šè©±å±¥æ­´å½¢å¼** | ãƒ†ã‚­ã‚¹ãƒˆçµ±åˆ | MessageParamé…åˆ— |
| **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°** | æ¨™æº– | è©³ç´°åŒ–ï¼ˆ401, 429, 500ï¼‰ |

---

## ğŸ’¡ å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ

### 1. Claude APIã®ç‰¹å¾´

#### ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
Claudeã¯`system`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å—ã‘å–ã‚Šã¾ã™ã€‚

```typescript
const response = await this.client.messages.create({
  model: this.model,
  max_tokens: 4096,
  system: systemPrompt,  // â† å°‚ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  messages: [...],
});
```

#### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼
Claude APIã¯`MessageParam[]`å½¢å¼ã‚’è¦æ±‚ã—ã¾ã™ã€‚

```typescript
messages: [
  { role: 'user', content: 'ã“ã‚“ã«ã¡ã¯' },
  { role: 'assistant', content: 'ã“ã‚“ã«ã¡ã¯ï¼' },
  { role: 'user', content: 'æ—…è¡Œã®ç›¸è«‡...' }
]
```

### 2. ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å®Ÿè£…

Claude SDKã¯`messages.stream()`ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚’æä¾›ï¼š

```typescript
const stream = await this.client.messages.stream({
  model: this.model,
  max_tokens: 4096,
  system: systemPrompt,
  messages: this.convertToClaudeMessages(chatHistory, userPrompt),
});

for await (const event of stream) {
  if (
    event.type === 'content_block_delta' &&
    event.delta.type === 'text_delta'
  ) {
    yield event.delta.text;
  }
}
```

### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

Claudeå›ºæœ‰ã®ã‚¨ãƒ©ãƒ¼ã‚’è©³ç´°åŒ–ï¼š

```typescript
catch (error: any) {
  if (error.status === 401) {
    throw new Error('Claude APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™ã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
  } else if (error.status === 429) {
    throw new Error('APIåˆ©ç”¨åˆ¶é™ã«é”ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚');
  } else if (error.status === 500) {
    throw new Error('Claude APIã‚µãƒ¼ãƒãƒ¼ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
  }
  throw new Error(`Claude API error: ${error.message}`);
}
```

### 4. APIã‚­ãƒ¼æ¤œè¨¼ã®å¼·åŒ–

Phase 6.1ã§ã¯å½¢å¼ãƒã‚§ãƒƒã‚¯ã®ã¿ã§ã—ãŸãŒã€Phase 6.2ã§ã¯å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ã§æ¤œè¨¼ï¼š

```typescript
export async function validateClaudeApiKey(apiKey: string) {
  try {
    const client = new Anthropic({ apiKey });
    
    // æœ€å°é™ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦æ¤œè¨¼
    await client.messages.create({
      model: 'claude-sonnet-4-5-20250929',
      max_tokens: 10,
      messages: [{ role: 'user', content: 'test' }],
    });

    return { isValid: true };
  } catch (error: any) {
    if (error.status === 401) {
      return { isValid: false, error: 'APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™' };
    }
    // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å ´åˆã¯å½¢å¼çš„ã«ã¯OK
    if (error.status === 429) {
      return { isValid: true };
    }
    return { isValid: false, error: 'APIã‚­ãƒ¼ã®æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ' };
  }
}
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰

### äº‹å‰æº–å‚™

1. **Claude APIã‚­ãƒ¼ã®å–å¾—**
   - [Anthropic Console](https://console.anthropic.com/settings/keys) ã«ã‚¢ã‚¯ã‚»ã‚¹
   - APIã‚­ãƒ¼ã‚’ä½œæˆï¼ˆ"sk-ant-..." ã§å§‹ã¾ã‚‹ï¼‰
   - ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã®ç™»éŒ²ãŒå¿…è¦

2. **APIã‚­ãƒ¼ã®ç™»éŒ²**
   - ã‚¢ãƒ—ãƒªã«ãƒ­ã‚°ã‚¤ãƒ³
   - ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã€Œè¨­å®šã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   - Claude APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ä¿å­˜

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

#### 1. Claudeé¸æŠãƒ†ã‚¹ãƒˆ

**æ‰‹é †**:
1. AIã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã§ã€ŒClaude 4.5 Sonnetã€ã‚’é¸æŠ
2. ï¼ˆAPIã‚­ãƒ¼æœªç™»éŒ²ã®å ´åˆï¼‰è‡ªå‹•çš„ã«ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹
3. APIã‚­ãƒ¼ã‚’ç™»éŒ²
4. Claudeé¸æŠçŠ¶æ…‹ã«ãªã‚‹

**æœŸå¾…çµæœ**:
- âœ… Claudeé¸æŠæ™‚ã«è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œãªã„
- âœ… APIã‚­ãƒ¼ç™»éŒ²å¾Œã€å³åº§ã«ä½¿ç”¨å¯èƒ½

#### 2. Claudeãƒãƒ£ãƒƒãƒˆï¼ˆéã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼‰ãƒ†ã‚¹ãƒˆ

**æ‰‹é †**:
1. Claudeé¸æŠ
2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡: ã€Œã“ã‚“ã«ã¡ã¯ã€
3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¢ºèª

**æœŸå¾…çµæœ**:
- âœ… Claude 4.5 Sonnetã‹ã‚‰ã®å¿œç­”ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„

#### 3. Claudeãƒãƒ£ãƒƒãƒˆï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼‰ãƒ†ã‚¹ãƒˆ

**æ‰‹é †**:
1. Claudeé¸æŠ
2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡: ã€Œæ±äº¬ã§2æ³Š3æ—¥ã®æ—…è¡Œãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€
3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

**æœŸå¾…çµæœ**:
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… ã—ãŠã‚Šãƒ‡ãƒ¼ã‚¿ãŒç”Ÿæˆã•ã‚Œã‚‹
- âœ… JSONãƒ‡ãƒ¼ã‚¿ãŒè‡ªå‹•çš„ã«ãƒ‘ãƒ¼ã‚¹ã•ã‚Œã€ã—ãŠã‚Šã«åæ˜ ã•ã‚Œã‚‹

#### 4. AIåˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ

**æ‰‹é †**:
1. Geminiã§ä¼šè©±é–‹å§‹: ã€Œäº¬éƒ½æ—…è¡Œã®ç›¸è«‡ã€
2. AIã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’Claudeã«åˆ‡ã‚Šæ›¿ãˆ
3. ç¶šã‘ã¦è³ªå•: ã€Œè¦³å…‰ã‚¹ãƒãƒƒãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€
4. å†åº¦Geminiã«åˆ‡ã‚Šæ›¿ãˆ
5. ç¶šã‘ã¦è³ªå•: ã€Œäºˆç®—ã‚’æ•™ãˆã¦ãã ã•ã„ã€

**æœŸå¾…çµæœ**:
- âœ… AIåˆ‡ã‚Šæ›¿ãˆå¾Œã‚‚ä¼šè©±å±¥æ­´ãŒä¿æŒã•ã‚Œã‚‹
- âœ… ã—ãŠã‚Šãƒ‡ãƒ¼ã‚¿ãŒç¶™ç¶šçš„ã«æ›´æ–°ã•ã‚Œã‚‹
- âœ… å„AIã®å¿œç­”ã‚¹ã‚¿ã‚¤ãƒ«ã®é•ã„ãŒç¢ºèªã§ãã‚‹

#### 5. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ

**ã‚±ãƒ¼ã‚¹1: ç„¡åŠ¹ãªAPIã‚­ãƒ¼**
1. è¨­å®šã§ä¸æ­£ãªAPIã‚­ãƒ¼ã‚’ç™»éŒ²
2. Claudeã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡

**æœŸå¾…çµæœ**:
- âŒ ã€ŒClaude APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™ã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã€ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

**ã‚±ãƒ¼ã‚¹2: APIã‚­ãƒ¼æœªç™»éŒ²**
1. APIã‚­ãƒ¼ã‚’å‰Šé™¤
2. Claudeã‚’é¸æŠã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡

**æœŸå¾…çµæœ**:
- âŒ ã€ŒClaude API key is requiredã€ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

**ã‚±ãƒ¼ã‚¹3: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼**
1. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’åˆ‡æ–­
2. Claudeã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡

**æœŸå¾…çµæœ**:
- âŒ é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹

#### 6. ã—ãŠã‚Šç”Ÿæˆãƒ»æ›´æ–°ãƒ†ã‚¹ãƒˆ

**æ‰‹é †**:
1. Claudeã‚’é¸æŠ
2. ã€Œå¤§é˜ªã§3æ—¥é–“ã®æ—…è¡Œãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚ã‚°ãƒ«ãƒ¡ã¨è¦³å…‰ã‚’ãƒãƒ©ãƒ³ã‚¹ã‚ˆãã€‚ã€ã¨é€ä¿¡
3. ã—ãŠã‚ŠãŒç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
4. ã€Œ2æ—¥ç›®ã«é“é “å €ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€ã¨é€ä¿¡
5. ã—ãŠã‚ŠãŒæ›´æ–°ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

**æœŸå¾…çµæœ**:
- âœ… åˆå›ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã—ãŠã‚ŠãŒç”Ÿæˆã•ã‚Œã‚‹
- âœ… è¿½åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§æ—¢å­˜ã—ãŠã‚ŠãŒæ›´æ–°ã•ã‚Œã‚‹ï¼ˆç½®ãæ›ãˆã§ãªãè¿½åŠ ï¼‰
- âœ… JSONãƒ‡ãƒ¼ã‚¿ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤ºã•ã‚Œãªã„

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ï¼ˆå‚è€ƒå€¤ï¼‰

| æ“ä½œ | Gemini 2.5 Pro | Claude 4.5 Sonnet |
|------|----------------|-------------------|
| åˆå›å¿œç­”ï¼ˆTTFBï¼‰ | ~1-2ç§’ | ~1-2ç§’ |
| ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å®Œäº† | ~5-10ç§’ | ~5-10ç§’ |
| ã—ãŠã‚Šç”Ÿæˆ | ~10-15ç§’ | ~10-15ç§’ |

*ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã‚„ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã«ã‚ˆã‚Šå¤‰å‹•

### ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡

- **Claude 4.5 Sonnet**: max_tokens = 4096
- ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ: ç´„500ãƒˆãƒ¼ã‚¯ãƒ³
- ã—ãŠã‚Šç”Ÿæˆ: ç´„2000-3000ãƒˆãƒ¼ã‚¯ãƒ³
- é€šå¸¸ä¼šè©±: ç´„500-1000ãƒˆãƒ¼ã‚¯ãƒ³

---

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### APIã‚­ãƒ¼ã®å–ã‚Šæ‰±ã„

1. **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰**:
   - LocalStorageã«æš—å·åŒ–ã—ã¦ä¿å­˜
   - XORæš—å· + Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
   - âš ï¸ å®Œå…¨ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯ä¿è¨¼ã•ã‚Œãªã„

2. **ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰**:
   - Claude APIã‚­ãƒ¼ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«å—ã‘å–ã‚‹
   - ã‚µãƒ¼ãƒãƒ¼ã«ä¿å­˜ã—ãªã„ï¼ˆã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ï¼‰
   - ç’°å¢ƒå¤‰æ•°ã«ã¯ä¿å­˜ã—ãªã„ï¼ˆGeminiã¨ã¯ç•°ãªã‚‹ï¼‰

3. **æ¨å¥¨äº‹é …**:
   - å…±æœ‰PCã§ã¯ä½¿ç”¨å¾Œã«å¿…ãšAPIã‚­ãƒ¼ã‚’å‰Šé™¤
   - å®šæœŸçš„ã«APIã‚­ãƒ¼ã‚’ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
   - æœ¬ç•ªç’°å¢ƒã§ã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®ç®¡ç†ã‚’æ¤œè¨

---

## ğŸ› æ—¢çŸ¥ã®åˆ¶é™äº‹é …

### Phase 6.2ã§ã®åˆ¶é™

1. **APIã‚­ãƒ¼ç®¡ç†**:
   - ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®APIã‚­ãƒ¼ä¿å­˜ã¯æœªå®Ÿè£…
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®APIã‚­ãƒ¼ç®¡ç†ã¯LocalStorageã®ã¿

2. **ä½¿ç”¨é‡è¿½è·¡**:
   - ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã®è¿½è·¡æ©Ÿèƒ½ãªã—
   - ã‚³ã‚¹ãƒˆç®¡ç†æ©Ÿèƒ½ãªã—

3. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**:
   - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ãªã—
   - ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã®ã¿

4. **ä¼šè©±å±¥æ­´**:
   - æœ€æ–°10ä»¶ã®ã¿ã‚’é€ä¿¡
   - é•·ã„ä¼šè©±ã§ã¯æ–‡è„ˆãŒå¤±ã‚ã‚Œã‚‹å¯èƒ½æ€§

---

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### æ›´æ–°ãƒ•ã‚¡ã‚¤ãƒ«

```
lib/
â”œâ”€â”€ ai/
â”‚   â””â”€â”€ claude.ts              # ClaudeClientå®Œå…¨å®Ÿè£…
â””â”€â”€ utils/
    â””â”€â”€ api-client.ts          # Claudeå¯¾å¿œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ 

app/api/chat/
â””â”€â”€ route.ts                   # Claudeå¯¾å¿œãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¿½åŠ 

components/
â””â”€â”€ chat/
    â”œâ”€â”€ MessageInput.tsx       # Claude APIã‚­ãƒ¼æ¸¡ã—
    â””â”€â”€ AISelector.tsx         # è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤
```

### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«
```
docs/
â””â”€â”€ PHASE6_2_IMPLEMENTATION.md # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

### ä¾å­˜é–¢ä¿‚
```
package.json                   # @anthropic-ai/sdkè¿½åŠ 
```

---

## ğŸ”œ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: Phase 6.3 / Phase 3.5

### Phase 6.3: AIãƒ¢ãƒ‡ãƒ«åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ã®å¼·åŒ–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

1. **ãƒ¢ãƒ‡ãƒ«å›ºæœ‰ã®æ©Ÿèƒ½**:
   - [ ] Claudeã®æ€è€ƒéç¨‹è¡¨ç¤ºï¼ˆThinkingï¼‰
   - [ ] Geminiå›ºæœ‰ã®æ©Ÿèƒ½æ´»ç”¨

2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**:
   - [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - [ ] ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡æœ€é©åŒ–

3. **ä½¿ç”¨é‡ç®¡ç†**:
   - [ ] ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã®è¿½è·¡
   - [ ] ã‚³ã‚¹ãƒˆè¨ˆç®—æ©Ÿèƒ½
   - [ ] æœˆé–“ä½¿ç”¨é‡ã®ä¸Šé™è¨­å®š

### ã¾ãŸã¯ Phase 3.5: UI/UXæ”¹å–„

1. **ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°**:
   - [ ] `react-markdown`ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
   - [ ] MessageListã®æ›´æ–°
   - [ ] ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆå¯¾å¿œ

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 6.2å®Ÿè£…å®Œäº†é …ç›®

- [x] Anthropic SDKã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- [x] ClaudeClientã‚¯ãƒ©ã‚¹ã®å®Ÿè£…ï¼ˆchat, chatStreamï¼‰
- [x] Claudeç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰
- [x] Claudeã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®å®Ÿè£…
- [x] ãƒãƒ£ãƒƒãƒˆAPIãƒ«ãƒ¼ãƒˆã®Claudeå¯¾å¿œ
- [x] MessageInputã®æ›´æ–°ï¼ˆClaude APIã‚­ãƒ¼æ¸¡ã—ï¼‰
- [x] APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æ›´æ–°ï¼ˆClaudeå¯¾å¿œï¼‰
- [x] AISelectorã®è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤
- [x] package.jsonã®æ›´æ–°
- [x] å®Ÿè£…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½œæˆ

### å‹•ä½œç¢ºèªé …ç›®

- [ ] Claude APIã‚­ãƒ¼ã®ç™»éŒ²ãƒ»å‰Šé™¤
- [ ] Claudeé¸æŠæ™‚ã®å‹•ä½œ
- [ ] Claudeãƒãƒ£ãƒƒãƒˆï¼ˆéã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼‰
- [ ] Claudeãƒãƒ£ãƒƒãƒˆï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼‰
- [ ] Geminiã¨Claudeã®åˆ‡ã‚Šæ›¿ãˆ
- [ ] ã—ãŠã‚Šç”Ÿæˆãƒ»æ›´æ–°
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] APIã‚­ãƒ¼æ¤œè¨¼

---

## ğŸ“ ã¾ã¨ã‚

Phase 6.2ã§ã¯ã€Claude APIã®å®Œå…¨çµ±åˆã‚’å®Ÿç¾ã—ã¾ã—ãŸã€‚ä¸»ãªãƒã‚¤ãƒ³ãƒˆï¼š

1. âœ… **Geminiäº’æ›ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å¤‰æ›´ã‚’æœ€å°åŒ–
2. âœ… **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œ**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“
3. âœ… **å …ç‰¢ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: Claudeå›ºæœ‰ã®ã‚¨ãƒ©ãƒ¼ã«å¯¾å¿œ
4. âœ… **å®Ÿéš›ã®APIæ¤œè¨¼**: APIã‚­ãƒ¼ã®æœ‰åŠ¹æ€§ã‚’ç¢ºèª
5. âœ… **å®Œå…¨ã«æ©Ÿèƒ½ã™ã‚‹AIåˆ‡ã‚Šæ›¿ãˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªç”±ã«ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠå¯èƒ½

ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä»¥ä¸‹ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸï¼š
- Geminiï¼ˆç’°å¢ƒå¤‰æ•°ã®APIã‚­ãƒ¼ï¼‰ã¾ãŸã¯Claudeï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã®APIã‚­ãƒ¼ï¼‰ã‚’é¸æŠ
- ä¸¡æ–¹ã®AIãƒ¢ãƒ‡ãƒ«ã§æ—…ã®ã—ãŠã‚Šã‚’ä½œæˆ
- ä¼šè©±ã®é€”ä¸­ã§AIãƒ¢ãƒ‡ãƒ«ã‚’åˆ‡ã‚Šæ›¿ãˆ
- å„AIã®ç‰¹å¾´ã‚’æ´»ã‹ã—ãŸæ—…è¡Œè¨ˆç”»ã®ä½œæˆ

---

**å®Ÿè£…å®Œäº†æ—¥**: 2025-10-07  
**å®Ÿè£…è€…**: AI Assistant  
**ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è¦ç¢ºèª

**æ¬¡ã®æ¨å¥¨Phase**:
- **BUG-001**: JSONå‰Šé™¤ãƒã‚°ä¿®æ­£ï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰
- **Phase 3.5**: UI/UXæ”¹å–„ï¼ˆãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰
- **Phase 4**: æ®µéšçš„æ—…ç¨‹æ§‹ç¯‰ã‚·ã‚¹ãƒ†ãƒ 
