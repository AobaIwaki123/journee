# Phase 4.10: 一気通貫作成モード - UI設計詳細

## 📋 UI設計の基本方針

### 設計思想

**ボタンではなくステータス表示**:
- QuickActionsの「次へ」ボタンは廃止
- 代わりに、しおりの作成段階を示す**ステータスバー（プログレスバー）**を表示
- ユーザーは進捗を見守るだけ（Netflix風のUX）

**自動進行がデフォルト**:
- 必須情報が揃ったら、自動的にしおり作成開始
- ユーザーの操作は不要（メッセージを送信するだけ）

---

## 🎨 新しいUI構成

### 全体レイアウト

```
┌─────────────────────────────────────────┐
│ ヘッダー: 旅のしおり                       │
├─────────────────────────────────────────┤
│ PhaseStatusBar                          │
│ ┌─────┐───┌─────┐───┌─────┐───┌─────┐ │
│ │情報 │   │骨組 │   │詳細 │   │完成 │ │
│ │収集 │   │作成 │   │  化 │   │     │ │
│ └─────┘   └─────┘   └─────┘   └─────┘ │
│ [━━━━━━━━━━━━━━━━ 60% ━━━━━    ]       │
├─────────────────────────────────────────┤
│ AutoModeNotification (必須情報が揃ったら) │
│ ⚡ 準備完了！自動的にしおりを作成します     │
├─────────────────────────────────────────┤
│                                         │
│ しおりコンテンツ                          │
│                                         │
│ - タイトル                               │
│ - 日程表                                 │
│ - 観光スポット                            │
│                                         │
└─────────────────────────────────────────┘
```

### 自動進行中の全画面オーバーレイ

```
┌─────────────────────────────────────────┐
│          [背景: 半透明ブラック]            │
│                                         │
│   ┌───────────────────────────────┐    │
│   │                               │    │
│   │  旅のしおりを作成中             │    │
│   │  しばらくお待ちください...       │    │
│   │                               │    │
│   │  [━━━━━━━━━ 45% ━━━    ]      │    │
│   │                               │    │
│   │  🔄 1日目詳細化中...           │    │
│   │                               │    │
│   │  ┌───┬───┬───┬───┐          │    │
│   │  │✓1 │🔄2│ 3 │ 4 │          │    │
│   │  └───┴───┴───┴───┘          │    │
│   │                               │    │
│   │      [キャンセル]              │    │
│   │                               │    │
│   └───────────────────────────────┘    │
│                                         │
└─────────────────────────────────────────┘
```

---

## 🔧 コンポーネント詳細

### 1. PhaseStatusBar

**目的**: しおりの作成段階を視覚的に表示

**表示内容**:
- 4つのフェーズを横並びで表示
  - ⭕ 情報収集（collecting）
  - ⭕ 骨組み作成（skeleton）
  - ⭕ 詳細化（detailing）
  - ⭕ 完成（completed）
- 各フェーズの状態:
  - ✅ 完了: 緑色 + チェックマーク
  - 🔵 現在: 青色 + ローディングアニメーション（自動進行中）
  - ⚪ 未完了: グレー
- フェーズ間の接続線（完了したフェーズまで緑色）
- 自動進行中は全体の進捗率を表示

**ファイル**: `components/itinerary/PhaseStatusBar.tsx`

```typescript
interface PhaseStep {
  id: ItineraryPhase;
  label: string;
  description: string;
}

const PHASE_STEPS: PhaseStep[] = [
  { id: 'collecting', label: '情報収集', description: '...' },
  { id: 'skeleton', label: '骨組み作成', description: '...' },
  { id: 'detailing', label: '詳細化', description: '...' },
  { id: 'completed', label: '完成', description: '...' },
];
```

**状態管理**:
```typescript
const { planningPhase, autoProgressState } = useStore();
```

**視覚的な状態**:

| 状態 | 色 | アイコン | アニメーション |
|------|---|---------|--------------|
| 完了 | 🟢 緑 | ✅ Check | なし |
| 現在（進行中） | 🔵 青 | 🔄 Loader2 | spin（回転） |
| 現在（停止中） | 🔵 青 | ⭕ Circle | なし |
| 未完了 | ⚪ グレー | ⭕ Circle | なし |

---

### 2. AutoModeNotification

**目的**: 必須情報が揃ったことを通知

**表示条件**:
- `autoProgressSettings.enabled === true`
- `buttonReadiness.level === 'ready'`
- `planningPhase === 'collecting'`

**表示内容**:
```
┌─────────────────────────────────────────┐
│ ⚡ 準備完了！                             │
│                                         │
│ 必須情報が揃いました。メッセージを送信すると、│
│ 自動的にしおりを作成します。               │
│                                         │
│ ⚙️ 自動作成モード ON                     │
└─────────────────────────────────────────┘
```

**ファイル**: `components/itinerary/AutoModeNotification.tsx`

**デザイン**:
- 背景: グラデーション（青→緑）
- ボーダー: 青色
- アイコン: ⚡ Zap（青色）

---

### 3. FullProgressOverlay

**目的**: 自動進行中の全画面進捗表示

**表示条件**:
- `autoProgressState.isActive === true`

**表示内容**:
- モーダルオーバーレイ（背景: 半透明ブラック）
- 中央にカード（白背景、丸角、シャドウ）
- タイトル: 「旅のしおりを作成中」
- サブタイトル: 「しばらくお待ちください...」
- 進捗バー: 全体の進捗率（0-100%）
- 現在のステップ: 「骨組み作成中...」など
- 各日の状態表示（detailingフェーズのみ）
  - ✅ 完了: 緑色
  - 🔄 処理中: 青色
  - ⚠️ エラー: 赤色
  - ⚪ 未処理: グレー
- キャンセルボタン

**ファイル**: `components/autoProgress/FullProgressOverlay.tsx`

**状態管理**:
```typescript
const {
  autoProgressState: {
    isActive,
    currentStep,
    progressRate,
    processingDays,
    completedDays,
    errorDays,
  },
  cancelAutoProgress,
} = useStore();
```

**ステップラベル**:
```typescript
const stepLabels = {
  idle: '',
  skeleton: '骨組みを作成中...',
  detailing: '日程の詳細を作成中...',
  completing: '仕上げ中...',
};
```

---

### 4. QuickActionsの廃止

**変更内容**:
- `components/itinerary/QuickActions.tsx` を削除または非表示
- 代わりに `PhaseStatusBar` と `AutoModeNotification` を使用

**理由**:
- 自動モードがデフォルトのため、「次へ」ボタンは不要
- ユーザーの操作は不要（メッセージ送信のみ）
- ボタンではなくステータス表示に変更

**移行計画**:
1. Phase 4.10.3で `PhaseStatusBar` を実装
2. `ItineraryPreview` に `PhaseStatusBar` を追加
3. `QuickActions` を条件付きで非表示
4. 最終的に `QuickActions` を完全削除

---

## 🎯 ユーザーフロー（UI視点）

### フロー1: 情報収集中

```
[PhaseStatusBar]
⭕ 情報収集 (現在) ─── ⚪ 骨組み作成 ─── ⚪ 詳細化 ─── ⚪ 完成

[チャット]
ユーザー: 「東京に行きたいです」
AI: 「承知しました。何泊何日を予定されていますか？」
```

### フロー2: 必須情報が揃った

```
[PhaseStatusBar]
⭕ 情報収集 (現在) ─── ⚪ 骨組み作成 ─── ⚪ 詳細化 ─── ⚪ 完成

[AutoModeNotification]
⚡ 準備完了！
必須情報が揃いました。メッセージを送信すると、自動的にしおりを作成します。
⚙️ 自動作成モード ON

[チャット]
ユーザー: 「3泊4日で」
AI: 「承知しました。それでは...」
↓
自動進行開始！
```

### フロー3: 自動進行中（骨組み作成）

```
[FullProgressOverlay] ← 全画面オーバーレイ表示
┌───────────────────────────────┐
│  旅のしおりを作成中             │
│  しばらくお待ちください...       │
│                               │
│  [━━━━━━━ 20% ━━━━    ]       │
│                               │
│  🔄 骨組みを作成中...           │
│                               │
│      [キャンセル]              │
└───────────────────────────────┘
```

### フロー4: 自動進行中（詳細化）

```
[FullProgressOverlay]
┌───────────────────────────────┐
│  旅のしおりを作成中             │
│  しばらくお待ちください...       │
│                               │
│  [━━━━━━━━━ 65% ━━    ]       │
│                               │
│  🔄 日程の詳細を作成中...       │
│                               │
│  ┌───┬───┬───┬───┐          │
│  │✅1│✅2│🔄3│⚪4│          │
│  └───┴───┴───┴───┘          │
│                               │
│      [キャンセル]              │
└───────────────────────────────┘
```

### フロー5: 完成

```
[PhaseStatusBar]
✅ 情報収集 ━━━ ✅ 骨組み作成 ━━━ ✅ 詳細化 ━━━ ✅ 完成

[しおりプレビュー]
✨ 完成した旅のしおりが表示される
```

---

## 📐 デザイン仕様

### PhaseStatusBar

**サイズ**:
- 高さ: 120px
- 各ステップの円: 40px × 40px
- 接続線: 高さ 4px
- 進捗バー: 高さ 8px

**色**:
- 完了: `bg-green-500`（緑）
- 現在: `bg-blue-500`（青）
- 未完了: `bg-gray-200`（グレー）
- 接続線（完了）: `bg-green-500`
- 接続線（未完了）: `bg-gray-200`
- 進捗バー: `bg-blue-500`

**アニメーション**:
- 遷移: `transition-all duration-300`
- ローディング: `animate-spin`（Loader2アイコン）
- 進捗バー: `transition-all duration-500 ease-out`

---

### AutoModeNotification

**サイズ**:
- パディング: `p-4`
- マージン: `mx-4 mb-4`
- アイコン: 24px × 24px

**色**:
- 背景: `bg-gradient-to-r from-blue-50 to-green-50`
- ボーダー: `border-blue-200`
- テキスト: `text-blue-900`（タイトル）、`text-blue-800`（本文）
- アイコン: `text-blue-600`

---

### FullProgressOverlay

**サイズ**:
- オーバーレイ: 全画面（`fixed inset-0`）
- カード: 最大幅 `max-w-md`（448px）
- パディング: `p-8`
- 進捗バー: 高さ 12px
- 各日の円: 48px × 48px

**色**:
- オーバーレイ背景: `bg-black/50 backdrop-blur-sm`
- カード背景: `bg-white`
- 進捗バー: `bg-blue-500`
- 各日（完了）: `bg-green-100 text-green-700`
- 各日（処理中）: `bg-blue-100 text-blue-700`
- 各日（エラー）: `bg-red-100 text-red-700`
- 各日（未処理）: `bg-gray-100 text-gray-400`

**アニメーション**:
- フェードイン: `opacity` アニメーション
- 進捗バー: `transition-all duration-500 ease-out`
- ローディング: `animate-spin`

---

## 🧪 レスポンシブ対応

### モバイル（< 768px）

**PhaseStatusBar**:
- ステップラベルを省略（アイコンのみ）
- 縦向き表示に変更（オプション）

**FullProgressOverlay**:
- カード幅を画面幅の90%に変更
- 各日の表示を2列グリッドに変更

---

## 📋 実装チェックリスト

### Phase 4.10.3: UI実装

- [ ] `PhaseStatusBar.tsx` の作成
  - [ ] フェーズステップの定義
  - [ ] ステップインジケーターのレンダリング
  - [ ] 接続線のレンダリング
  - [ ] 進捗バーの表示（自動進行中のみ）
  - [ ] アニメーションの実装

- [ ] `AutoModeNotification.tsx` の作成
  - [ ] 表示条件の実装
  - [ ] デザインの実装
  - [ ] 設定へのリンク

- [ ] `FullProgressOverlay.tsx` の修正
  - [ ] 各日の状態表示を追加
  - [ ] グリッドレイアウトの実装
  - [ ] アイコンの表示

- [ ] `ItineraryPreview.tsx` の修正
  - [ ] `PhaseStatusBar` の追加
  - [ ] `AutoModeNotification` の追加
  - [ ] レイアウトの調整

- [ ] `QuickActions.tsx` の廃止
  - [ ] 条件付きで非表示
  - [ ] 最終的に削除

- [ ] レスポンシブ対応
  - [ ] モバイル向けのスタイル調整
  - [ ] Tailwind CSSのブレークポイント使用

---

**関連ドキュメント**:
- [Phase 4.10: 一気通貫作成モード](./PHASE4_10_AUTO_EXECUTION.md)
- [Phase 4.8: 自動フェーズ移動](./PHASE4_8_AUTO_PHASE_TRANSITION.md)