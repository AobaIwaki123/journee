# しおり機能 ドキュメント

Journeeアプリケーションの中核機能である「旅のしおり」に関する全ての仕様をまとめたドキュメント集です。

## 📚 ドキュメント一覧

### 1. [アーキテクチャ概要](./architecture.md)
- 現状のアーキテクチャ
- レイヤー構造
- 問題点と課題
- 理想的なアーキテクチャ

### 2. [コンポーネント仕様](./components.md)
- 26個のUIコンポーネント詳細
- 表示系、編集系、アクション系、進捗表示系、リスト系
- Props、依存Hook、使用箇所
- 統合すべきコンポーネントの提案

### 3. [状態管理仕様](./state-management.md)
- Zustandストアの構成
- しおり関連のステート（10+項目）
- アクション一覧（20+メソッド）
- ストアのスライス分割提案

### 4. [カスタムHooks仕様](./hooks.md)
- 提案する7つの新しいHooks
  - `useItineraryEditor`
  - `useSpotEditor`
  - `useItinerarySave`
  - `useItineraryPublish`
  - `useItineraryPDF`
  - `useItineraryList`
  - `useItineraryHistory`
- 既存の地図関連Hooks

### 5. [ユーティリティ関数](./utils.md)
- ストレージ関連
- PDF生成
- 予算計算
- 時間管理
- 地図関連
- その他ユーティリティ

### 6. [API仕様](./api.md)
- 7つのAPIエンドポイント詳細
- リクエスト/レスポンス形式
- 認証・権限
- エラーハンドリング

### 7. [リファクタリング計画](./refactoring.md)
- Phase 1: カスタムHooks作成
- Phase 2: コンポーネント統合
- Phase 3: ストアのスライス分割
- Phase 4: 型定義の整理
- Phase 5: テストの追加

---

## 🎯 主要機能

- **しおりの作成・編集**: 段階的なしおり作成（collecting → skeleton → detailing → completed）
- **スポット管理**: 観光スポットの追加・編集・削除・並び替え
- **保存・読み込み**: DB（Supabase）またはLocalStorageへの永続化
- **公開・共有**: 公開URLの発行、共有機能
- **PDF出力**: jsPDFを使った高品質なPDF生成
- **地図表示**: Google Maps統合による位置情報表示
- **フィルター・ソート**: しおり一覧の検索・絞り込み

---

## 🔍 使い方

### しおり機能を新規実装する場合
1. [アーキテクチャ概要](./architecture.md)で全体像を理解
2. [コンポーネント仕様](./components.md)で必要なコンポーネントを確認
3. [カスタムHooks仕様](./hooks.md)でロジックの実装方法を確認
4. [状態管理仕様](./state-management.md)でストアの使い方を確認

### 既存のしおり機能を修正する場合
1. [コンポーネント仕様](./components.md)で該当コンポーネントを検索
2. [状態管理仕様](./state-management.md)で使用しているアクションを確認
3. 必要に応じて[ユーティリティ関数](./utils.md)を確認

### APIを追加・修正する場合
1. [API仕様](./api.md)で既存エンドポイントを確認
2. 必要に応じて新しいエンドポイントを追加

### リファクタリングを進める場合
1. [リファクタリング計画](./refactoring.md)で優先順位を確認
2. [カスタムHooks仕様](./hooks.md)で実装すべきHooksを確認
3. [コンポーネント仕様](./components.md)で統合すべきコンポーネントを確認

---

## 📊 統計情報

- **UIコンポーネント**: 26個
- **APIエンドポイント**: 7個
- **Zustandアクション**: 20+個
- **ユーティリティ関数**: 30+個
- **提案する新しいHooks**: 7個

---

## 🚨 現状の課題

1. ✅ **状態管理の肥大化**: `useStore.ts` が1200行以上
2. ✅ **カスタムHooksの不足**: 地図関連以外のHooksがほとんど存在しない
3. ✅ **コンポーネントの細分化**: 26個のコンポーネントが機能別に分散
4. ✅ **責務の重複**: `ItineraryCard`、`SpotCard` などで重複あり

---

## 🎯 改善の方向性

1. **カスタムHooksの作成** → ロジックをコンポーネントから分離
2. **コンポーネントの統合** → 26個 → 20個以下に削減
3. **ストアのスライス分割** → 責務を明確化
4. **型定義の整理** → `ItineraryData` の分割

---

**最終更新日**: 2025-01-10
**バージョン**: 1.0.0

