# Phase 4.8: ãƒ•ã‚§ãƒ¼ã‚ºç§»å‹•å‡¦ç†ã®åŠè‡ªå‹•åŒ– - è¨­è¨ˆæ›¸

## ğŸ“‹ æ¦‚è¦

ãƒãƒ£ãƒƒãƒˆå†…å®¹ã‹ã‚‰è‡ªå‹•çš„ã«å¿…è¦æƒ…å ±ã®å……è¶³åº¦ã‚’åˆ¤å®šã—ã€æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸é€²ã‚€ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¦–è¦šçš„ã«ç¤ºã™ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸é€²ã‚ã‚‹ã‚ˆã†ã€ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãªã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

**ç›®çš„**: 
- æƒ…å ±ä¸è¶³ã«ã‚ˆã‚‹ä¸å®Œå…¨ãªã—ãŠã‚Šç”Ÿæˆã‚’é˜²ã
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸é€²ã‚ã‚‹
- æŸ”è»Ÿæ€§ã‚’ä¿ã¡ã¤ã¤ã€ã‚¹ãƒãƒ¼ãƒˆãªã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã‚’æä¾›

---

## ğŸ¯ ä¸»è¦æ©Ÿèƒ½

### 1. æƒ…å ±å……è¶³åº¦ã®è‡ªå‹•åˆ¤å®š
- ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‹ã‚‰æ—…è¡Œæƒ…å ±ã‚’æŠ½å‡º
- å„ãƒ•ã‚§ãƒ¼ã‚ºã§å¿…è¦ãªæƒ…å ±ã®æœ‰ç„¡ã‚’ãƒã‚§ãƒƒã‚¯
- å……è¶³ç‡ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¨ˆç®—

### 2. å‹•çš„ãªãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
- å¿…é ˆæƒ…å ±ãŒæƒã£ãŸå ´åˆ: å¼·èª¿è¡¨ç¤ºï¼ˆç·‘è‰²ã€è„ˆå‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- ä¸€éƒ¨æƒ…å ±ãŒä¸è¶³: é€šå¸¸è¡¨ç¤ºï¼ˆé’è‰²ï¼‰
- æƒ…å ±ãŒå¤§å¹…ã«ä¸è¶³: æŠ‘åˆ¶è¡¨ç¤ºï¼ˆã‚°ãƒ¬ãƒ¼ + è­¦å‘Šã‚¢ã‚¤ã‚³ãƒ³ï¼‰

### 3. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆè¡¨ç¤º
- åé›†ã™ã¹ãæƒ…å ±ã‚’è¦–è¦šçš„ã«è¡¨ç¤º
- å„é …ç›®ã®å……è¶³çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã§è¡¨ç¤º
- å…¨ä½“ã®å……è¶³ç‡ã‚’ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã§è¡¨ç¤º

### 4. æŸ”è»Ÿãªé€²è¡Œè¨±å®¹
- æƒ…å ±ãŒä¸è¶³ã—ã¦ã„ã¦ã‚‚ã€Œã“ã®ã¾ã¾é€²ã‚€ã€ã‚’é¸æŠå¯èƒ½
- AIãŒä¸è¶³æƒ…å ±ã‚’è£œå®Œã¾ãŸã¯è¿½åŠ è³ªå•

---

## ğŸ“Š å‹å®šç¾©

### types/requirements.ts

```typescript
/**
 * ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé …ç›®
 */
export interface RequirementChecklistItem {
  /** é …ç›®ID */
  id: string;
  
  /** é …ç›®å */
  label: string;
  
  /** èª¬æ˜ */
  description?: string;
  
  /** å¿…é ˆé …ç›®ã‹ã©ã†ã‹ */
  required: boolean;
  
  /** å……è¶³çŠ¶æ…‹ */
  status: 'empty' | 'partial' | 'filled';
  
  /** æŠ½å‡ºã•ã‚ŒãŸå€¤ */
  value?: any;
  
  /** è‡ªå‹•æŠ½å‡ºé–¢æ•° */
  extractor?: (messages: ChatMessage[], itinerary?: ItineraryData) => any;
}

/**
 * ãƒ•ã‚§ãƒ¼ã‚ºã”ã¨ã®è¦ä»¶
 */
export interface PhaseRequirements {
  /** ãƒ•ã‚§ãƒ¼ã‚º */
  phase: ItineraryPhase;
  
  /** å¿…é ˆé …ç›®ã®ãƒªã‚¹ãƒˆ */
  requiredItems: string[];
  
  /** ã‚ªãƒ—ã‚·ãƒ§ãƒ³é …ç›®ã®ãƒªã‚¹ãƒˆ */
  optionalItems: string[];
  
  /** å…¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé …ç›® */
  items: RequirementChecklistItem[];
}

/**
 * ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®çŠ¶æ…‹
 */
export interface ChecklistStatus {
  /** å…¨ä½“ã®å……è¶³ç‡ï¼ˆ0-100ï¼‰ */
  completionRate: number;
  
  /** å¿…é ˆé …ç›®ãŒã™ã¹ã¦å……è¶³ã•ã‚Œã¦ã„ã‚‹ã‹ */
  allRequiredFilled: boolean;
  
  /** å¿…é ˆé …ç›®ã®å……è¶³æ•° */
  requiredFilled: number;
  
  /** å¿…é ˆé …ç›®ã®ç·æ•° */
  requiredTotal: number;
  
  /** ã‚ªãƒ—ã‚·ãƒ§ãƒ³é …ç›®ã®å……è¶³æ•° */
  optionalFilled: number;
  
  /** ã‚ªãƒ—ã‚·ãƒ§ãƒ³é …ç›®ã®ç·æ•° */
  optionalTotal: number;
  
  /** ä¸è¶³ã—ã¦ã„ã‚‹å¿…é ˆé …ç›®ã®ãƒªã‚¹ãƒˆ */
  missingRequired: string[];
  
  /** æ¨å¥¨ã•ã‚Œã‚‹æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ */
  recommendedAction: 'proceed' | 'collect_more' | 'wait';
}

/**
 * ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹
 */
export type ButtonReadinessLevel = 'ready' | 'partial' | 'not_ready';

export interface ButtonReadiness {
  /** æº–å‚™åº¦ãƒ¬ãƒ™ãƒ« */
  level: ButtonReadinessLevel;
  
  /** ãƒœã‚¿ãƒ³ã®ãƒ©ãƒ™ãƒ« */
  label: string;
  
  /** ãƒœã‚¿ãƒ³ã®è‰² */
  color: 'green' | 'blue' | 'gray';
  
  /** ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æœ‰ç„¡ */
  animate: boolean;
  
  /** ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
  tooltip: string;
  
  /** ä¸è¶³æƒ…å ±ã®ãƒªã‚¹ãƒˆ */
  missingInfo?: string[];
}
```

---

## ğŸ— ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### æƒ…å ±æŠ½å‡ºã®æµã‚Œ

```
[ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡]
    â†“
[MessageInput] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
    â†“
[useStore] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ãŒæ›´æ–°ã•ã‚Œã‚‹
    â†“
[extractTravelInfo] ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‹ã‚‰æƒ…å ±ã‚’æŠ½å‡º
    â†“
[updateChecklist] ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’æ›´æ–°
    â†“
[calculateChecklistStatus] å……è¶³ç‡ã‚’è¨ˆç®—
    â†“
[determineButtonReadiness] ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ±ºå®š
    â†“
[QuickActions] ãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®ã‚’æ›´æ–°
```

---

## ğŸ”§ å®Ÿè£…è©³ç´°

### 4.8.1 æƒ…å ±å……è¶³åº¦ãƒã‚§ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ 

#### ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®å®šç¾©

**ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/requirements/checklist-config.ts`

```typescript
import type { RequirementChecklistItem, PhaseRequirements } from '@/types/requirements';

/**
 * å„ãƒ•ã‚§ãƒ¼ã‚ºã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆè¨­å®š
 */
export const PHASE_REQUIREMENTS: Record<ItineraryPhase, PhaseRequirements> = {
  initial: {
    phase: 'initial',
    requiredItems: [],
    optionalItems: [],
    items: [],
  },
  
  collecting: {
    phase: 'collecting',
    requiredItems: ['destination', 'duration'],
    optionalItems: ['budget', 'travelers', 'interests'],
    items: [
      {
        id: 'destination',
        label: 'è¡Œãå…ˆ',
        description: 'æ—…è¡Œå…ˆã®éƒ½å¸‚ã‚„åœ°åŸŸ',
        required: true,
        status: 'empty',
        extractor: extractDestination,
      },
      {
        id: 'duration',
        label: 'æ—¥ç¨‹',
        description: 'æ—…è¡Œã®æ—¥æ•°ã¾ãŸã¯æœŸé–“',
        required: true,
        status: 'empty',
        extractor: extractDuration,
      },
      {
        id: 'budget',
        label: 'äºˆç®—',
        description: 'æ—…è¡Œã®äºˆç®—ç›®å®‰',
        required: false,
        status: 'empty',
        extractor: extractBudget,
      },
      {
        id: 'travelers',
        label: 'äººæ•°',
        description: 'æ—…è¡Œè€…ã®äººæ•°ãƒ»æ§‹æˆ',
        required: false,
        status: 'empty',
        extractor: extractTravelers,
      },
      {
        id: 'interests',
        label: 'èˆˆå‘³ãƒ»ãƒ†ãƒ¼ãƒ',
        description: 'è¦³å…‰ã€ã‚°ãƒ«ãƒ¡ã€è‡ªç„¶ãªã©',
        required: false,
        status: 'empty',
        extractor: extractInterests,
      },
    ],
  },
  
  skeleton: {
    phase: 'skeleton',
    requiredItems: ['destination', 'duration', 'theme_ideas'],
    optionalItems: ['area_preferences'],
    items: [
      {
        id: 'theme_ideas',
        label: 'å„æ—¥ã®ãƒ†ãƒ¼ãƒã‚¢ã‚¤ãƒ‡ã‚¢',
        description: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¸Œæœ›ã™ã‚‹å„æ—¥ã®å¤§ã¾ã‹ãªãƒ†ãƒ¼ãƒ',
        required: true,
        status: 'empty',
        extractor: extractThemeIdeas,
      },
      {
        id: 'area_preferences',
        label: 'ã‚¨ãƒªã‚¢ã®å¸Œæœ›',
        description: 'è¨ªã‚ŒãŸã„ã‚¨ãƒªã‚¢ã‚„é¿ã‘ãŸã„ã‚¨ãƒªã‚¢',
        required: false,
        status: 'empty',
        extractor: extractAreaPreferences,
      },
    ],
  },
  
  detailing: {
    phase: 'detailing',
    requiredItems: ['skeleton_created'],
    optionalItems: ['spot_preferences', 'meal_preferences'],
    items: [
      {
        id: 'skeleton_created',
        label: 'éª¨çµ„ã¿ã®ä½œæˆ',
        description: 'å„æ—¥ã®ãƒ†ãƒ¼ãƒãŒæ±ºå®šã—ã¦ã„ã‚‹',
        required: true,
        status: 'empty',
        extractor: checkSkeletonCreated,
      },
      {
        id: 'spot_preferences',
        label: 'è¦³å…‰ã‚¹ãƒãƒƒãƒˆã®å¸Œæœ›',
        description: 'è¨ªã‚ŒãŸã„è¦³å…‰ã‚¹ãƒãƒƒãƒˆ',
        required: false,
        status: 'empty',
        extractor: extractSpotPreferences,
      },
      {
        id: 'meal_preferences',
        label: 'é£Ÿäº‹ã®å¸Œæœ›',
        description: 'é£Ÿã¹ãŸã„æ–™ç†ã‚„é¿ã‘ãŸã„é£Ÿã¹ç‰©',
        required: false,
        status: 'empty',
        extractor: extractMealPreferences,
      },
    ],
  },
  
  completed: {
    phase: 'completed',
    requiredItems: [],
    optionalItems: [],
    items: [],
  },
};
```

#### æƒ…å ±æŠ½å‡ºé–¢æ•°

**ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/requirements/extractors.ts`

```typescript
import type { ChatMessage } from '@/types/chat';
import type { ItineraryData } from '@/types/itinerary';

/**
 * è¡Œãå…ˆã‚’æŠ½å‡º
 */
export function extractDestination(
  messages: ChatMessage[],
  itinerary?: ItineraryData
): string | null {
  // ã—ãŠã‚Šã«æ—¢ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ
  if (itinerary?.destination) {
    return itinerary.destination;
  }
  
  // ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‹ã‚‰æŠ½å‡º
  const destinationKeywords = ['è¡ŒããŸã„', 'æ—…è¡Œ', 'è¡Œã', 'è¨ªã‚Œã‚‹'];
  const placePatterns = [
    /(?:æ±äº¬|å¤§é˜ª|äº¬éƒ½|åŒ—æµ·é“|æ²–ç¸„|åå¤å±‹|ç¦å²¡|åºƒå³¶|ä»™å°|æœ­å¹Œ)/,
    /(?:ãƒãƒ¯ã‚¤|ãƒ‘ãƒª|ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯|ãƒ­ãƒ³ãƒ‰ãƒ³|ãƒãƒª|å°æ¹¾|éŸ“å›½|ã‚¿ã‚¤)/,
  ];
  
  for (const msg of messages.slice().reverse()) {
    if (msg.role === 'user') {
      // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹
      const hasKeyword = destinationKeywords.some(kw => msg.content.includes(kw));
      
      if (hasKeyword) {
        // åœ°åãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒã™ã‚‹ã‹
        for (const pattern of placePatterns) {
          const match = msg.content.match(pattern);
          if (match) {
            return match[0];
          }
        }
      }
    }
  }
  
  return null;
}

/**
 * æ—¥ç¨‹ã‚’æŠ½å‡º
 */
export function extractDuration(
  messages: ChatMessage[],
  itinerary?: ItineraryData
): number | null {
  // ã—ãŠã‚Šã«æ—¢ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ
  if (itinerary?.duration) {
    return itinerary.duration;
  }
  
  // ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‹ã‚‰æŠ½å‡º
  const durationPatterns = [
    /(\d+)æ—¥/,
    /(\d+)æ³Š/,
    /(\d+)æ³Š(\d+)æ—¥/,
  ];
  
  for (const msg of messages.slice().reverse()) {
    if (msg.role === 'user') {
      for (const pattern of durationPatterns) {
        const match = msg.content.match(pattern);
        if (match) {
          return parseInt(match[1], 10);
        }
      }
    }
  }
  
  return null;
}

/**
 * äºˆç®—ã‚’æŠ½å‡º
 */
export function extractBudget(
  messages: ChatMessage[],
  itinerary?: ItineraryData
): number | null {
  if (itinerary?.totalBudget) {
    return itinerary.totalBudget;
  }
  
  const budgetPatterns = [
    /äºˆç®—.*?(\d+)ä¸‡/,
    /(\d+)ä¸‡å††/,
    /(\d+)å††/,
  ];
  
  for (const msg of messages.slice().reverse()) {
    if (msg.role === 'user') {
      for (const pattern of budgetPatterns) {
        const match = msg.content.match(pattern);
        if (match) {
          const value = parseInt(match[1], 10);
          // ã€Œä¸‡å††ã€ã®å ´åˆã¯10000å€
          if (msg.content.includes('ä¸‡')) {
            return value * 10000;
          }
          return value;
        }
      }
    }
  }
  
  return null;
}

/**
 * æ—…è¡Œè€…æƒ…å ±ã‚’æŠ½å‡º
 */
export function extractTravelers(
  messages: ChatMessage[],
  itinerary?: ItineraryData
): { count: number; type?: string } | null {
  const travelerPatterns = [
    /(\d+)äºº/,
    /(ä¸€äºº|ã‚½ãƒ­|1äºº)/,
    /(ã‚«ãƒƒãƒ—ãƒ«|æ‹äºº|äºŒäºº|2äºº)/,
    /(å®¶æ—|å­ä¾›|è¦ªå­)/,
    /(å‹é”|å‹äºº)/,
  ];
  
  for (const msg of messages.slice().reverse()) {
    if (msg.role === 'user') {
      for (const pattern of travelerPatterns) {
        const match = msg.content.match(pattern);
        if (match) {
          if (match[0].includes('ä¸€äºº') || match[0].includes('ã‚½ãƒ­')) {
            return { count: 1, type: 'solo' };
          }
          if (match[0].includes('ã‚«ãƒƒãƒ—ãƒ«') || match[0].includes('æ‹äºº')) {
            return { count: 2, type: 'couple' };
          }
          if (match[0].includes('å®¶æ—') || match[0].includes('å­ä¾›')) {
            return { count: 3, type: 'family' };
          }
          const count = parseInt(match[1], 10);
          if (!isNaN(count)) {
            return { count };
          }
        }
      }
    }
  }
  
  return null;
}

/**
 * èˆˆå‘³ãƒ»ãƒ†ãƒ¼ãƒã‚’æŠ½å‡º
 */
export function extractInterests(
  messages: ChatMessage[],
  itinerary?: ItineraryData
): string[] {
  const interests: string[] = [];
  const interestKeywords = {
    sightseeing: ['è¦³å…‰', 'åæ‰€', 'è¦³ã‚‹'],
    gourmet: ['ã‚°ãƒ«ãƒ¡', 'é£Ÿã¹ç‰©', 'æ–™ç†', 'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³'],
    nature: ['è‡ªç„¶', 'å±±', 'æµ·', 'æ™¯è‰²'],
    history: ['æ­´å²', 'æ–‡åŒ–', 'å¯º', 'ç¥ç¤¾'],
    shopping: ['ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°', 'è²·ã„ç‰©'],
    relaxation: ['ãƒªãƒ©ãƒƒã‚¯ã‚¹', 'æ¸©æ³‰', 'ã‚¹ãƒ‘'],
  };
  
  for (const msg of messages) {
    if (msg.role === 'user') {
      for (const [key, keywords] of Object.entries(interestKeywords)) {
        if (keywords.some(kw => msg.content.includes(kw))) {
          if (!interests.includes(key)) {
            interests.push(key);
          }
        }
      }
    }
  }
  
  return interests;
}

// ä»–ã®æŠ½å‡ºé–¢æ•°ã‚‚åŒæ§˜ã«å®Ÿè£…...
```

#### ZustandçŠ¶æ…‹ç®¡ç†ã®æ‹¡å¼µ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/store/useStore.ts` ã«è¿½åŠ 

```typescript
import type { 
  RequirementChecklistItem, 
  ChecklistStatus,
  ButtonReadiness 
} from '@/types/requirements';
import { PHASE_REQUIREMENTS } from '@/lib/requirements/checklist-config';
import { 
  calculateChecklistStatus,
  determineButtonReadiness 
} from '@/lib/requirements/checklist-utils';

interface AppState {
  // ... æ—¢å­˜ã®çŠ¶æ…‹ ...
  
  // Phase 4.8: ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆçŠ¶æ…‹
  requirementsChecklist: RequirementChecklistItem[];
  checklistStatus: ChecklistStatus | null;
  buttonReadiness: ButtonReadiness | null;
  
  // Phase 4.8: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  updateChecklist: () => void;
  getChecklistForPhase: (phase: ItineraryPhase) => RequirementChecklistItem[];
}

export const useStore = create<AppState>((set, get) => ({
  // ... æ—¢å­˜ã®å®Ÿè£… ...
  
  // Phase 4.8: åˆæœŸçŠ¶æ…‹
  requirementsChecklist: [],
  checklistStatus: null,
  buttonReadiness: null,
  
  // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’æ›´æ–°
  updateChecklist: () => {
    const { messages, currentItinerary, planningPhase } = get();
    
    // ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚ºã®è¦ä»¶ã‚’å–å¾—
    const requirements = PHASE_REQUIREMENTS[planningPhase];
    
    // å„é …ç›®ã‚’è©•ä¾¡
    const updatedItems = requirements.items.map(item => {
      if (item.extractor) {
        const value = item.extractor(messages, currentItinerary || undefined);
        return {
          ...item,
          value,
          status: value ? 'filled' : 'empty',
        } as RequirementChecklistItem;
      }
      return item;
    });
    
    // å……è¶³ç‡ã‚’è¨ˆç®—
    const status = calculateChecklistStatus(updatedItems, requirements);
    
    // ãƒœã‚¿ãƒ³ã®æº–å‚™åº¦ã‚’æ±ºå®š
    const readiness = determineButtonReadiness(status, planningPhase);
    
    set({
      requirementsChecklist: updatedItems,
      checklistStatus: status,
      buttonReadiness: readiness,
    });
  },
  
  // ç‰¹å®šãƒ•ã‚§ãƒ¼ã‚ºã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’å–å¾—
  getChecklistForPhase: (phase: ItineraryPhase) => {
    const requirements = PHASE_REQUIREMENTS[phase];
    return requirements.items;
  },
}));
```

---

### 4.8.3 QuickActionsãƒœã‚¿ãƒ³ã®å‹•çš„ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°

**ãƒ•ã‚¡ã‚¤ãƒ«**: `components/itinerary/QuickActions.tsx` ã‚’æ›´æ–°

```typescript
'use client';

import React, { useState, useEffect } from 'react';
import { useStore } from '@/lib/store/useStore';
import { ArrowRight, RotateCcw, Check, AlertCircle } from 'lucide-react';

export const QuickActions: React.FC = () => {
  const {
    planningPhase,
    buttonReadiness,
    checklistStatus,
    updateChecklist,
    proceedToNextStep,
    // ...
  } = useStore();
  
  const [showWarning, setShowWarning] = useState(false);
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ã—ãŠã‚ŠãŒæ›´æ–°ã•ã‚ŒãŸã‚‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’æ›´æ–°
  useEffect(() => {
    updateChecklist();
  }, [updateChecklist]);
  
  const handleNextStep = () => {
    if (!buttonReadiness) return;
    
    // å¿…é ˆæƒ…å ±ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã¯è­¦å‘Šã‚’è¡¨ç¤º
    if (buttonReadiness.level === 'not_ready' && checklistStatus) {
      setShowWarning(true);
      return;
    }
    
    // æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸é€²ã‚€
    proceedToNextStep();
    // AIã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡...
  };
  
  const handleForceNext = () => {
    setShowWarning(false);
    proceedToNextStep();
    // AIã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡...
  };
  
  if (!buttonReadiness) return null;
  
  return (
    <div className="border-t bg-white p-4">
      {/* è­¦å‘Šãƒ€ã‚¤ã‚¢ãƒ­ã‚° */}
      {showWarning && checklistStatus && (
        <div className="mb-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
          <div className="flex items-start space-x-3">
            <AlertCircle className="w-5 h-5 text-yellow-600 mt-0.5" />
            <div className="flex-1">
              <h4 className="font-medium text-yellow-900 mb-2">
                ä»¥ä¸‹ã®æƒ…å ±ãŒä¸è¶³ã—ã¦ã„ã¾ã™
              </h4>
              <ul className="list-disc list-inside text-sm text-yellow-800 space-y-1">
                {checklistStatus.missingRequired.map(item => (
                  <li key={item}>{item}</li>
                ))}
              </ul>
              <div className="mt-4 flex space-x-2">
                <button
                  onClick={() => setShowWarning(false)}
                  className="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700"
                >
                  æƒ…å ±ã‚’è¿½åŠ ã™ã‚‹
                </button>
                <button
                  onClick={handleForceNext}
                  className="px-4 py-2 border border-yellow-600 text-yellow-700 rounded-lg hover:bg-yellow-50"
                >
                  ã“ã®ã¾ã¾é€²ã‚€
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
      
      {/* æ¬¡ã¸ãƒœã‚¿ãƒ³ */}
      <button
        onClick={handleNextStep}
        disabled={planningPhase === 'completed'}
        title={buttonReadiness.tooltip}
        className={`
          w-full flex items-center justify-center space-x-2 px-4 py-3 rounded-lg 
          font-medium transition-all
          ${getButtonStyles(buttonReadiness)}
        `}
      >
        {buttonReadiness.level === 'ready' ? (
          <Check className="w-5 h-5" />
        ) : buttonReadiness.level === 'not_ready' ? (
          <AlertCircle className="w-5 h-5" />
        ) : (
          <ArrowRight className="w-5 h-5" />
        )}
        <span>{buttonReadiness.label}</span>
      </button>
      
      {/* ä¸è¶³æƒ…å ±ã®ãƒ’ãƒ³ãƒˆ */}
      {buttonReadiness.missingInfo && buttonReadiness.missingInfo.length > 0 && (
        <div className="mt-2 text-xs text-gray-500 text-center">
          ã¾ã : {buttonReadiness.missingInfo.join('ã€')} ãŒæœªè¨­å®šã§ã™
        </div>
      )}
    </div>
  );
};

function getButtonStyles(readiness: ButtonReadiness): string {
  const baseStyles = 'shadow-sm hover:shadow';
  
  switch (readiness.level) {
    case 'ready':
      return `${baseStyles} bg-green-500 text-white hover:bg-green-600 ${
        readiness.animate ? 'animate-pulse' : ''
      }`;
    case 'partial':
      return `${baseStyles} bg-blue-500 text-white hover:bg-blue-600`;
    case 'not_ready':
      return `${baseStyles} bg-gray-300 text-gray-600 cursor-not-allowed`;
    default:
      return baseStyles;
  }
}
```

---

### 4.8.4 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆè¡¨ç¤ºUI

**ãƒ•ã‚¡ã‚¤ãƒ«**: `components/itinerary/RequirementsChecklist.tsx`

```typescript
'use client';

import React, { useState } from 'react';
import { useStore } from '@/lib/store/useStore';
import { ChevronDown, ChevronUp, Check, Circle } from 'lucide-react';
import type { RequirementChecklistItem } from '@/types/requirements';

export const RequirementsChecklist: React.FC = () => {
  const { requirementsChecklist, checklistStatus } = useStore();
  const [isExpanded, setIsExpanded] = useState(false);
  
  if (!checklistStatus || requirementsChecklist.length === 0) {
    return null;
  }
  
  return (
    <div className="bg-white border rounded-lg overflow-hidden">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <button
        onClick={() => setIsExpanded(!isExpanded)}
        className="w-full flex items-center justify-between p-4 hover:bg-gray-50"
      >
        <div className="flex items-center space-x-3">
          <div className="text-sm font-medium">
            å¿…è¦ãªæƒ…å ± ({checklistStatus.requiredFilled}/{checklistStatus.requiredTotal})
          </div>
          <div className="text-xs text-gray-500">
            {Math.round(checklistStatus.completionRate)}% å®Œäº†
          </div>
        </div>
        {isExpanded ? (
          <ChevronUp className="w-4 h-4 text-gray-400" />
        ) : (
          <ChevronDown className="w-4 h-4 text-gray-400" />
        )}
      </button>
      
      {/* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */}
      <div className="px-4 pb-3">
        <div className="w-full bg-gray-200 rounded-full h-2">
          <div
            className="bg-blue-500 h-2 rounded-full transition-all"
            style={{ width: `${checklistStatus.completionRate}%` }}
          />
        </div>
      </div>
      
      {/* ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé …ç›® */}
      {isExpanded && (
        <div className="border-t divide-y">
          {requirementsChecklist.map(item => (
            <ChecklistItem key={item.id} item={item} />
          ))}
        </div>
      )}
    </div>
  );
};

const ChecklistItem: React.FC<{ item: RequirementChecklistItem }> = ({ item }) => {
  return (
    <div className="p-4 flex items-start space-x-3">
      {/* ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ */}
      <div className="flex-shrink-0 mt-0.5">
        {item.status === 'filled' ? (
          <div className="w-5 h-5 bg-green-500 rounded-full flex items-center justify-center">
            <Check className="w-3 h-3 text-white" />
          </div>
        ) : (
          <Circle className="w-5 h-5 text-gray-300" />
        )}
      </div>
      
      {/* é …ç›®æƒ…å ± */}
      <div className="flex-1">
        <div className="flex items-center space-x-2">
          <div className="font-medium text-sm">{item.label}</div>
          {item.required && (
            <span className="text-xs text-red-500">å¿…é ˆ</span>
          )}
        </div>
        {item.description && (
          <div className="text-xs text-gray-500 mt-1">{item.description}</div>
        )}
        {item.value && (
          <div className="text-xs text-blue-600 mt-1">
            è¨­å®šæ¸ˆã¿: {formatValue(item.value)}
          </div>
        )}
      </div>
    </div>
  );
};

function formatValue(value: any): string {
  if (typeof value === 'string') return value;
  if (typeof value === 'number') return value.toString();
  if (Array.isArray(value)) return value.join(', ');
  if (typeof value === 'object') return JSON.stringify(value);
  return String(value);
}
```

---

## ğŸ¨ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

### Tailwind CSSè¨­å®š

**ãƒ•ã‚¡ã‚¤ãƒ«**: `tailwind.config.ts`

```typescript
export default {
  theme: {
    extend: {
      animation: {
        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
      },
    },
  },
};
```

---

## ğŸ“± ä½¿ç”¨ä¾‹

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼

1. **æƒ…å ±åé›†ãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹**
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œæ±äº¬ã«3æ³Š4æ—¥ã§æ—…è¡Œã«è¡ŒããŸã„ã§ã™ã€
   - ã‚·ã‚¹ãƒ†ãƒ : ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’æ›´æ–°ï¼ˆè¡Œãå…ˆ: âœ“ã€æ—¥ç¨‹: âœ“ï¼‰
   - ãƒœã‚¿ãƒ³: é’è‰²è¡¨ç¤ºï¼ˆä¸€éƒ¨æƒ…å ±å……è¶³ï¼‰

2. **ã•ã‚‰ã«æƒ…å ±ã‚’è¿½åŠ **
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œäºˆç®—ã¯10ä¸‡å††ãã‚‰ã„ã§ã€è¦³å…‰ã¨ã‚°ãƒ«ãƒ¡ãŒæ¥½ã—ã¿ãŸã„ã§ã™ã€
   - ã‚·ã‚¹ãƒ†ãƒ : ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’æ›´æ–°ï¼ˆäºˆç®—: âœ“ã€èˆˆå‘³: âœ“ï¼‰
   - ãƒœã‚¿ãƒ³: ç·‘è‰²ã«å¤‰åŒ– + è„ˆå‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¿…é ˆæƒ…å ±å……è¶³ï¼‰

3. **æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸é€²ã‚€**
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   - ã‚·ã‚¹ãƒ†ãƒ : skeleton ãƒ•ã‚§ãƒ¼ã‚ºã¸ç§»è¡Œ
   - AI: ã€Œãã‚Œã§ã¯å„æ—¥ã®ãƒ†ãƒ¼ãƒã‚’æ±ºã‚ã¦ã„ãã¾ã—ã‚‡ã†...ã€

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆé …ç›®

### è‡ªå‹•ãƒ†ã‚¹ãƒˆ
- [ ] æƒ…å ±æŠ½å‡ºé–¢æ•°ã®å˜ä½“ãƒ†ã‚¹ãƒˆ
- [ ] ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆæ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
- [ ] å……è¶³ç‡è¨ˆç®—ã®ãƒ†ã‚¹ãƒˆ
- [ ] ãƒœã‚¿ãƒ³æº–å‚™åº¦åˆ¤å®šã®ãƒ†ã‚¹ãƒˆ

### æ‰‹å‹•ãƒ†ã‚¹ãƒˆ
- [ ] æ®µéšçš„ã«æƒ…å ±ã‚’è¿½åŠ ã—ãŸå ´åˆã®ãƒœã‚¿ãƒ³å¤‰åŒ–
- [ ] å¿…é ˆæƒ…å ±ãŒæƒã£ãŸç¬é–“ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] æƒ…å ±ä¸è¶³æ™‚ã®è­¦å‘Šãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- [ ] ã€Œã“ã®ã¾ã¾é€²ã‚€ã€ã®å‹•ä½œ
- [ ] ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿

---

## ğŸ“ å®Ÿè£…å„ªå…ˆé †ä½

### Phase 1ï¼ˆåŸºæœ¬æ©Ÿèƒ½ï¼‰
1. âœ… å‹å®šç¾©ã®ä½œæˆ
2. âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆè¨­å®šã®å®šç¾©
3. âœ… åŸºæœ¬çš„ãªæƒ…å ±æŠ½å‡ºé–¢æ•°ï¼ˆdestination, durationï¼‰
4. âœ… ZustandçŠ¶æ…‹ç®¡ç†ã®æ‹¡å¼µ
5. âœ… QuickActionsãƒœã‚¿ãƒ³ã®å‹•çš„ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°

### Phase 2ï¼ˆUIå¼·åŒ–ï¼‰
6. âœ… RequirementsChecklistã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
7. âœ… è­¦å‘Šãƒ€ã‚¤ã‚¢ãƒ­ã‚°
8. âœ… ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ

### Phase 3ï¼ˆæœ€é©åŒ–ï¼‰
9. â¬œ é«˜åº¦ãªæƒ…å ±æŠ½å‡ºï¼ˆNLPæ´»ç”¨ï¼‰
10. â¬œ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
11. â¬œ ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š

---

**å®Ÿè£…å®Œäº†äºˆå®š**: Phase 4.6, 4.7ã®å¾Œ  
**æ¨å®šå·¥æ•°**: 3-4æ—¥  
**ä¾å­˜é–¢ä¿‚**: Phase 4.1~4.5ã®å®Œäº†