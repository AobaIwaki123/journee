ブログの下書きを書いていく

# `ISOLATED_BRANCH_ENV.md`:

このプロジェクトでは、ブランチごとに独立した環境を作成しています。
技術的に面白い試みかつ、個人レベルでやっている人はあまりいないと思われるため、ブログにしたい

## タイトル: 【AI駆動開発】まだレビューする時にブランチ移動してるの？

## ブログを書く際に準備するもの

- 小規模で今回の記事の内容を体感できる。マニフェストやGitHub Actionを構成すること。

## 想定読者

- kubectlコマンドが使える。または、この記事を読んでなんとなく使い方が理解できる。
- ブランチごとにデプロイするという技術に興味があるが、簡単に実装する方法を知らなかった人

## 想定しない読者

- k8sやdockerがまるでわからない

## はじめに

- ブランチごとに環境を立てているというアイデアを伝えたい
- 個人開発では不要と思われるかもしれないが、個人でも並列にAIを動作させることで10タスクでもこなせる現代では、一々ブランチを移動してレビューしていたらとんでもない時間がかかってしまう。その手間を解決するソリューション。
- メリットを多く伝え、期待感をあげこの後割とたくさんの作業をすることになるもののそれでも得られるメリットと比較すれば非常に軽いものであると思わせたい。

## 前提条件

- なんでもいいのでコンテナレジストリを使用可能なこと。この記事では、GCRの一般的なセットアップ方法を簡潔に記載する。

## 必要な環境変数

- `ARGOCD_TOKEN`: ArgoCD上にアプリを作成・削除・同期するのに使用するトークン
- `GCP_SA_KEY`: GCPのサービスアカウントキー。GCRにイメージをプッシュするために使用する。

## 環境構築: k8s編

- k8s環境が必要。自分の場合ミニPC3台で環境構築をしている
- 流石にハードルが高いので、GKEやEKSの一般的な使用方法を簡潔に説明
- 目標: kubectlがローカルで使用できればOK。いくつかのコマンドを記載する。

## 環境構築: ArgoCD/Cloudflare Ingress Controller編

- 基本的に[このリポジトリ](https://github.com/AobaIwaki123/k8s-cluster)の手順を`1'`まで進めればできるはず
- Cloudflare Ingress Controller: ドメインをYAMLに書くだけでドメイン発行から公開までしてくれる優れもの、かなりの分量を割いてお勧めしたい

## 環境構築: 確認編

- 基本的なk8s環境が整ったことを確認する。
- コマンド例をいくつか記載する。
- 短いargocd appを作成し、cloudflare ingress controllerで公開できることを体感できればなお良い。ただし、分量が多くなりそうな場合は省略

## 実装: ブランチごとに環境を立てるために必要なもの

- `.github/workflows/push.yml`: ブランチ固有のmanifest管理を行うGitHub Action。`metadata.name`など同一`namespace`でユニークである必要がある記述を修正する。
- `.github/workflows/create-argo-app.yml`: ArgoCD Applicationを作成するGitHub Action。ブランチごとに独立したApplicationを作成する。
- `.github/workflows/deploy.yml`: mainのアプリケーションをデプロイするために必要。基本的に`.github/workflows/push.yml`と同じかつ今回の記事にはあまり関係ないので紹介だけにとどめる。
